(window.webpackJsonp=window.webpackJsonp||[]).push([[387],{658:function(t,a,s){"use strict";s.r(a);var _=s(14),e=Object(_.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"_1-问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-问题"}},[t._v("#")]),t._v(" 1. 问题")]),t._v(" "),a("p",[t._v("qq小程序（基于uni-app）使用JS分发和组件分发插件后，有些页面会白屏，打开调试器，会看到下面的报错：")]),t._v(" "),a("img",{attrs:{src:"https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2023/5/own_mike_a0f5dfd42aa98ffea0.jpg",width:"500"}}),t._v(" "),a("p",[t._v("意思是找不到这个页面，然后列举了一系列的有效的组件。")]),t._v(" "),a("p",[t._v("这个问题只在qq小程序的真机上出现，在qq小程序开发者工具、微信小程序都没有。")]),t._v(" "),a("h2",{attrs:{id:"_2-原因"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-原因"}},[t._v("#")]),t._v(" 2. 原因")]),t._v(" "),a("p",[t._v("找了一圈原因，最后发现是执行顺序不同导致的原因。qq小程序真机上，并不是先运行"),a("code",[t._v("Page")]),t._v("页面，而是先执行每个组件，或者说校验每个合理的组件，而其他环境，都是先执行"),a("code",[t._v("Page")]),t._v("下的"),a("code",[t._v("js")]),t._v("。")]),t._v(" "),a("p",[a("code",[t._v("Page")]),t._v("下的"),a("code",[t._v("js")]),t._v("会加载此分包下的"),a("code",[t._v("vendor.js")]),t._v("，也就是每个页面下的"),a("code",[t._v("js")]),t._v("第一句都是下面的代码：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./common/vendor.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("global"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"webpackJsonp"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("global"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"webpackJsonp"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("这会加载分包中的"),a("code",[t._v("module")]),t._v("，注册一些"),a("code",[t._v("moduleId")]),t._v("。而"),a("code",[t._v("qq")]),t._v("小程序真机环境先执行了组件，此时如果某些"),a("code",[t._v("moduleId")]),t._v("还没注册的话，就会报错。")]),t._v(" "),a("h2",{attrs:{id:"_3-实验"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-实验"}},[t._v("#")]),t._v(" 3. 实验")]),t._v(" "),a("p",[t._v("我们检验一下这个结论，在组件和页面对应的JS中分别打印一句话，看看执行顺序。")]),t._v(" "),a("p",[t._v("在qq小程序真机下：")]),t._v(" "),a("img",{attrs:{src:"https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2023/5/own_mike_5c035aeb5615e7ef18.jpeg",width:"500"}}),t._v(" "),a("p",[t._v("在qq小程序开发者工具下：")]),t._v(" "),a("img",{attrs:{src:"https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2023/5/own_mike_e92cb7473fdd00a4a7.jpeg",width:"500"}}),t._v(" "),a("p",[t._v("上面的"),a("code",[t._v("create page")]),t._v("对应页面，"),a("code",[t._v("press switch")]),t._v("对应组件，可以看到"),a("code",[t._v("qq")]),t._v("小程序真机与开发者工具，对组件和页面的加载顺序确实不同。")]),t._v(" "),a("h2",{attrs:{id:"_4-解决"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-解决"}},[t._v("#")]),t._v(" 4. 解决")]),t._v(" "),a("p",[t._v("如何解决这个问题呢？既然组件需要这个"),a("code",[t._v("moduleId")]),t._v("，那就提前加载好就可以了。这里写了个插件，自动引入分包所在的"),a("code",[t._v("vendor")]),t._v("。")]),t._v(" "),a("p",[t._v("会不会有副作用呢？不会的，这里要了解下"),a("code",[t._v("webpack")]),t._v("运行时原理。"),a("code",[t._v("vendor.js")]),t._v("只是往"),a("code",[t._v('global["webpackJsonp"]')]),t._v("中"),a("code",[t._v("push")]),t._v("了一些"),a("code",[t._v("module")]),t._v("，"),a("code",[t._v("push")]),t._v("方法被"),a("code",[t._v("hook")]),t._v("了，本质是会缓存一些"),a("code",[t._v("moduleId")]),t._v("。")]),t._v(" "),a("p",[t._v("另外，那些并非插件移动的组件为什么没问题呢，因为它们和"),a("code",[t._v("Page")]),t._v("下的"),a("code",[t._v("js")]),t._v("一样，第一句都引用了分包中的"),a("code",[t._v("vendor.js")]),t._v("。")]),t._v(" "),a("h2",{attrs:{id:"_5-后记"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-后记"}},[t._v("#")]),t._v(" 5. 后记")]),t._v(" "),a("p",[t._v("虽然是个小问题，定位却花了不少时间，因为微信小程序没问题，所以没往执行顺序不同那方面想，期间猜想问题原因可能是"),a("code",[t._v("moduleId")]),t._v("找错了之类的。")]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"_2024-8-15-更新"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2024-8-15-更新"}},[t._v("#")]),t._v(" 2024.8.15 更新")]),t._v(" "),a("p",[t._v("用了插件后，还是出现白屏。")]),t._v(" "),a("p",[t._v("问题原因：uni-app 问题，QQ小程序打包 "),a("code",[t._v("vendor")]),t._v(" 时模块划分有问题，把应该放到主包的模块放到了分包中。")]),t._v(" "),a("p",[t._v("解决方法：需要确定被划分错的是哪个模块，比如最近一次的模块是 "),a("code",[t._v("@tencent/pmd-tools/lib/time")]),t._v("，当前的解决方法是把它放到 "),a("code",[t._v("main.js")]),t._v(" 中。")])])}),[],!1,null,null,null);a.default=e.exports}}]);