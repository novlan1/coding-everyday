(window.webpackJsonp=window.webpackJsonp||[]).push([[338],{639:function(s,t,a){"use strict";a.r(t);var n=a(25),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"bcryptjs插件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bcryptjs插件"}},[s._v("#")]),s._v(" bcryptjs插件")]),s._v(" "),t("p",[t("code",[s._v("Bcrypt")]),s._v("是单向"),t("code",[s._v("Hash")]),s._v("加密算法，类似"),t("code",[s._v("Pbkdf2")]),s._v("算法 不可反向破解生成明文。")]),s._v(" "),t("p",[s._v("比MD5、SHA1等加密算法更难破解。")]),s._v(" "),t("h3",{attrs:{id:"bcrypt是怎么加密的"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bcrypt是怎么加密的"}},[s._v("#")]),s._v(" Bcrypt是怎么加密的？")]),s._v(" "),t("p",[t("code",[s._v("Bcrypt")]),s._v("有四个变量：")]),s._v(" "),t("ol",[t("li",[t("code",[s._v("saltRounds")]),s._v(": 正数，代表"),t("code",[s._v("hash")]),s._v("杂凑次数，数值越高越安全，默认10次。")]),s._v(" "),t("li",[t("code",[s._v("myPassword")]),s._v(": 明文密码字符串。")]),s._v(" "),t("li",[t("code",[s._v("salt")]),s._v(": 盐，一个128"),t("code",[s._v("bits")]),s._v("随机字符串，22字符")]),s._v(" "),t("li",[t("code",[s._v("myHash")]),s._v(": 经过明文密码"),t("code",[s._v("password")]),s._v("和盐"),t("code",[s._v("salt")]),s._v("进行"),t("code",[s._v("hash")]),s._v("，个人的理解是默认10次下 ，循环加盐hash10次，得到"),t("code",[s._v("myHash")])])]),s._v(" "),t("p",[s._v("每次明文字符串"),t("code",[s._v("myPassword")]),s._v("过来，就通过10次循环加盐"),t("code",[s._v("salt")]),s._v("加密后得到"),t("code",[s._v("myHash")]),s._v(", 然后拼接"),t("code",[s._v("BCrypt")]),s._v("版本号+"),t("code",[s._v("salt")]),s._v("盐+"),t("code",[s._v("myHash")]),s._v("等到最终的"),t("code",[s._v("bcrypt")]),s._v("密码 ，存入数据库中。")]),s._v(" "),t("p",[s._v("这样同一个密码，每次登录都可以根据自省业务需要生成不同的"),t("code",[s._v("myHash")]),s._v(", "),t("code",[s._v("myHash")]),s._v("中包含了版本和"),t("code",[s._v("salt")]),s._v("，存入数据库。")]),s._v(" "),t("h3",{attrs:{id:"那如果黑客使用彩虹表进行hash碰撞呢"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#那如果黑客使用彩虹表进行hash碰撞呢"}},[s._v("#")]),s._v(" 那如果黑客使用彩虹表进行"),t("code",[s._v("hash")]),s._v("碰撞呢?")]),s._v(" "),t("p",[s._v("有文章指出"),t("code",[s._v("bcrypt")]),s._v("一个密码出来的时间比较长，需要0.3秒，而MD5只需要一微秒（百万分之一秒），一个40秒可以穷举得到明文的MD5，在"),t("code",[s._v("bcrypt")]),s._v("需要12年，时间成本太高。")]),s._v(" "),t("h3",{attrs:{id:"那他是如何验证密码的"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#那他是如何验证密码的"}},[s._v("#")]),s._v(" 那他是如何验证密码的？")]),s._v(" "),t("p",[s._v("在下次校验时，从"),t("code",[s._v("myHash")]),s._v("中取出"),t("code",[s._v("salt")]),s._v("，"),t("code",[s._v("salt")]),s._v("跟"),t("code",[s._v("password")]),s._v("进行"),t("code",[s._v("hash")]),s._v("；得到的结果跟保存在"),t("code",[s._v("DB")]),s._v("中的"),t("code",[s._v("hash")]),s._v("进行比对。")]),s._v(" "),t("p",[s._v("生成hash：")]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getHash")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("val")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" salt "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" bcrypt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("genSaltSync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" hash "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" bcrypt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("hashSync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("val"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" salt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Store hash in your password DB.")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" hash\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n")])])]),t("p",[s._v("校验密码：")]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("verifyHash")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("plainPwd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" correct "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" bcrypt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareSync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("plainPwd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" user"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("password"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" corrent "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// true or false")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);