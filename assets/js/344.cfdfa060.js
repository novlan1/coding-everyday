(window.webpackJsonp=window.webpackJsonp||[]).push([[344],{954:function(t,s,a){"use strict";a.r(s);var n=a(42),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"bcryptjs插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bcryptjs插件"}},[t._v("#")]),t._v(" bcryptjs插件")]),t._v(" "),a("p",[a("code",[t._v("Bcrypt")]),t._v("是单向"),a("code",[t._v("Hash")]),t._v("加密算法，类似"),a("code",[t._v("Pbkdf2")]),t._v("算法 不可反向破解生成明文。")]),t._v(" "),a("p",[t._v("比MD5、SHA1等加密算法更难破解。")]),t._v(" "),a("h3",{attrs:{id:"bcrypt是怎么加密的"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bcrypt是怎么加密的"}},[t._v("#")]),t._v(" Bcrypt是怎么加密的？")]),t._v(" "),a("p",[a("code",[t._v("Bcrypt")]),t._v("有四个变量：")]),t._v(" "),a("ol",[a("li",[a("code",[t._v("saltRounds")]),t._v(": 正数，代表"),a("code",[t._v("hash")]),t._v("杂凑次数，数值越高越安全，默认10次。")]),t._v(" "),a("li",[a("code",[t._v("myPassword")]),t._v(": 明文密码字符串。")]),t._v(" "),a("li",[a("code",[t._v("salt")]),t._v(": 盐，一个128"),a("code",[t._v("bits")]),t._v("随机字符串，22字符")]),t._v(" "),a("li",[a("code",[t._v("myHash")]),t._v(": 经过明文密码"),a("code",[t._v("password")]),t._v("和盐"),a("code",[t._v("salt")]),t._v("进行"),a("code",[t._v("hash")]),t._v("，个人的理解是默认10次下 ，循环加盐hash10次，得到"),a("code",[t._v("myHash")])])]),t._v(" "),a("p",[t._v("每次明文字符串"),a("code",[t._v("myPassword")]),t._v("过来，就通过10次循环加盐"),a("code",[t._v("salt")]),t._v("加密后得到"),a("code",[t._v("myHash")]),t._v(", 然后拼接"),a("code",[t._v("BCrypt")]),t._v("版本号+"),a("code",[t._v("salt")]),t._v("盐+"),a("code",[t._v("myHash")]),t._v("等到最终的"),a("code",[t._v("bcrypt")]),t._v("密码 ，存入数据库中。")]),t._v(" "),a("p",[t._v("这样同一个密码，每次登录都可以根据自省业务需要生成不同的"),a("code",[t._v("myHash")]),t._v(", "),a("code",[t._v("myHash")]),t._v("中包含了版本和"),a("code",[t._v("salt")]),t._v("，存入数据库。")]),t._v(" "),a("h3",{attrs:{id:"那如果黑客使用彩虹表进行hash碰撞呢"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#那如果黑客使用彩虹表进行hash碰撞呢"}},[t._v("#")]),t._v(" 那如果黑客使用彩虹表进行"),a("code",[t._v("hash")]),t._v("碰撞呢?")]),t._v(" "),a("p",[t._v("有文章指出"),a("code",[t._v("bcrypt")]),t._v("一个密码出来的时间比较长，需要0.3秒，而MD5只需要一微秒（百万分之一秒），一个40秒可以穷举得到明文的MD5，在"),a("code",[t._v("bcrypt")]),t._v("需要12年，时间成本太高。")]),t._v(" "),a("h3",{attrs:{id:"那他是如何验证密码的"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#那他是如何验证密码的"}},[t._v("#")]),t._v(" 那他是如何验证密码的？")]),t._v(" "),a("p",[t._v("在下次校验时，从"),a("code",[t._v("myHash")]),t._v("中取出"),a("code",[t._v("salt")]),t._v("，"),a("code",[t._v("salt")]),t._v("跟"),a("code",[t._v("password")]),t._v("进行"),a("code",[t._v("hash")]),t._v("；得到的结果跟保存在"),a("code",[t._v("DB")]),t._v("中的"),a("code",[t._v("hash")]),t._v("进行比对。")]),t._v(" "),a("p",[t._v("生成hash：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHash")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("val")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" salt "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" bcrypt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("genSaltSync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" hash "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" bcrypt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hashSync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("val"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" salt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Store hash in your password DB.")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" hash\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),a("p",[t._v("校验密码：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("verifyHash")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("plainPwd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" correct "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" bcrypt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("compareSync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("plainPwd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" corrent "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// true or false")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);