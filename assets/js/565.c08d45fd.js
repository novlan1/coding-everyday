(window.webpackJsonp=window.webpackJsonp||[]).push([[565],{841:function(t,s,a){"use strict";a.r(s);var n=a(14),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("[toc]")]),t._v(" "),s("h2",{attrs:{id:"_1-开始"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-开始"}},[t._v("#")]),t._v(" 1. 开始")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://h5.igame.qq.com/pmd-mobile.support.press-ui.press-ui/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Press UI"),s("OutboundLink")],1),t._v(" 近期迁入了活动组件，这里记录下遇到的问题、解决方法以及一些思考。")]),t._v(" "),s("p",[t._v("何为活动组件？这里指的是展示类的某业务组件。")]),t._v(" "),s("h2",{attrs:{id:"_2-样式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-样式"}},[t._v("#")]),t._v(" 2. 样式")]),t._v(" "),s("p",[t._v("样式处理是迁移的重点。关于样式，要处理以下几点：")]),t._v(" "),s("ol",[s("li",[t._v("如何在示例工程中"),s("strong",[t._v("动态切换样式")]),t._v("，使得开发者、使用者都方便调试")]),t._v(" "),s("li",[t._v("如何**动态隐藏 "),s("code",[t._v("@TIP_STYLE_NAME")]),t._v(" 引入的样式，**满足同一页面同一组件在不同位置有不同表现")]),t._v(" "),s("li",[t._v("如何让组件在拥有默认样式的同时，又可以随时去掉")]),t._v(" "),s("li",[t._v("如何改造之前的写法到 BEM")])]),t._v(" "),s("p",[t._v("下面一个个说。")]),t._v(" "),s("h3",{attrs:{id:"_2-1-动态切换样式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-动态切换样式"}},[t._v("#")]),t._v(" 2.1. 动态切换样式")]),t._v(" "),s("p",[t._v("要做到运行时动态切换样式，样式文件一定是打包进去的，可以是一个外链形式，也可以直接打到一起。")]),t._v(" "),s("p",[t._v("这里是示例工程，就直接打包到一起了。")]),t._v(" "),s("p",[t._v("本质是"),s("strong",[t._v("条件式动态引入样式")]),t._v("。页面切换参数后，给 "),s("code",[t._v("body")]),t._v(" 更改 "),s("code",[t._v("class")]),t._v("，组件 "),s("code",[t._v("Scss")]),t._v(" 中监听此 "),s("code",[t._v("class")]),t._v("，然后引入不同样式。")]),t._v(" "),s("p",[t._v("这里用了 "),s("code",[t._v("loader")]),t._v("，是因为样式类型特别多。崇尚刀耕火种的，也可以自己写。")]),t._v(" "),s("p",[t._v("插入内容示例如下：")]),t._v(" "),s("div",{staticClass:"language-scss extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scss"}},[s("code",[s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("body.press-act-award-dialog--type-pvp ")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./css/pvp.scss"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("body.press-act-award-dialog--type-gp ")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./css/gp.scss"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("img",{attrs:{src:"https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2023/11/own_mike_4c2a77c7fa33d7f435.png",width:"500"}}),t._v(" "),s("p",[t._v("小程序内稍有不同：")]),t._v(" "),s("ol",[s("li",[t._v("不支持在 "),s("code",[t._v("scss")]),t._v(" 中条件式动态引入外部 "),s("code",[t._v("scss")]),t._v("，只能在 Vue 文件中引入")]),t._v(" "),s("li",[t._v("不能在 "),s("code",[t._v("body(page)")]),t._v(" 上动态添加类名，只能在页面内部添加")]),t._v(" "),s("li",[s("code",[t._v("@font-face")]),t._v(" 在 "),s("code",[t._v("@import")]),t._v(" 动态引入后，会存在嵌套，导致报错")]),t._v(" "),s("li",[t._v("Vue 文件中动态引入的 "),s("code",[t._v("scss")]),t._v("，如果引入其他相对路径的文件，比如 "),s("code",[t._v("svg")]),t._v("，会存在引用地址错误")])]),t._v(" "),s("p",[t._v("所以在小程序中要动态切换样式时，会不得已在 "),s("code",[t._v("loader")]),t._v(" 或 "),s("code",[t._v("plugin")]),t._v(" 中，额外删除或替换掉部分内容。")]),t._v(" "),s("p",[t._v("这里会产生一个问题，要不要在 H5 和小程序端采用相同的方式，也就是 H5 是否使用阉割的方法？")]),t._v(" "),s("p",[t._v("我的选择是不要阉割，H5 应该始终保持"),s("strong",[t._v("高的语法灵活性、功能完备性")]),t._v("，不能因为是跨平台项目就去阉割。简单来说，"),s("strong",[t._v("尽量保持统一性，并追求“渐进式增强”")]),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"_2-2-动态隐藏-tip-style-name-样式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-动态隐藏-tip-style-name-样式"}},[t._v("#")]),t._v(" 2.2. 动态隐藏 @TIP_STYLE_NAME 样式")]),t._v(" "),s("p",[t._v("之前通过 "),s("code",[t._v("@TIP_STYLE_NAME")]),t._v(" 引入的样式，可以通过传入 "),s("code",[t._v("hideTipStyle")]),t._v(" 来隐藏。")]),t._v(" "),s("p",[t._v("Press UI 通过在"),s("strong",[t._v("组件顶部加类名")]),t._v("（注意不是结构），以及样式中控制，比如：")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("v-if")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("show"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v(":class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("[getActClass('cover'), {\n    'press-act--hidden-tip': hideTipStyle,\n  }, 'press-act']"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("div",{staticClass:"language-scss extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scss"}},[s("code",[t._v("."),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("press-act")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("not")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(".press-act--hidden-tip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v(".press__btn--small-primary ")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("display")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" inline-block"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("需要注意：")]),t._v(" "),s("ol",[s("li",[t._v("样式加了一级后，优先级会变，可能会造成局部异常")]),t._v(" "),s("li",[t._v("之前的顶部类名要兼容，可在对应的样式文件中搜索 "),s("code",[t._v("[^&].tip-comp-cover")]),t._v("，替换为 "),s("code",[t._v("&.tip-comp-cover")])]),t._v(" "),s("li",[s("code",[t._v("@import")]),t._v(" 语句不能写在非顶部，也就是包裹起来的部分，否则父组件可能引用不到变量，可以全局搜 "),s("code",[t._v("\\n@")]),t._v("，找到后移到顶部")])]),t._v(" "),s("h3",{attrs:{id:"_2-3-支持隐藏默认样式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-支持隐藏默认样式"}},[t._v("#")]),t._v(" 2.3. 支持隐藏默认样式")]),t._v(" "),s("p",[t._v("设置 "),s("code",[t._v("hideBaseStyle")]),t._v(" 为 "),s("code",[t._v("true")]),t._v(" 后，组件内在 "),s("code",[t._v("body")]),t._v(" 上添加 "),s("code",[t._v("{component}--hidden")]),t._v(" 的类名，组件样式据此判断是否加载默认样式。")]),t._v(" "),s("div",{staticClass:"language-scss extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scss"}},[s("code",[s("span",{pre:!0,attrs:{class:"token property"}},[t._v("body")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("not")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(".press-act-explain-dialog--hidden"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./css/pvp-vertical.scss"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"_2-4-bem-改造"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-bem-改造"}},[t._v("#")]),t._v(" 2.4. BEM 改造")]),t._v(" "),s("p",[s("strong",[t._v("想清楚为什么做比怎么做更重要")]),t._v("。")]),t._v(" "),s("p",[t._v("BEM 好处有：")]),t._v(" "),s("ol",[s("li",[t._v("见名知义，也就是结构和状态一看便知，可读性高")]),t._v(" "),s("li",[s("strong",[t._v("可读性高就意味着易维护")])])]),t._v(" "),s("p",[t._v("BEM 改造中需要注意：")]),t._v(" "),s("ol",[s("li",[t._v("组件库公共样式中，改造后的类名应全局保持一致")]),t._v(" "),s("li",[t._v("要兼容旧的写法，默认使用新写法")]),t._v(" "),s("li",[t._v("只有 "),s("code",[t._v("Vue")]),t._v(" 文件需要写两套类名，"),s("code",[t._v("Scss")]),t._v(" 文件不需要，因为加了 "),s("code",[t._v("scoped")]),t._v(" 后， "),s("code",[t._v("Scss")]),t._v(" 文件不会作用到外部")])]),t._v(" "),s("p",[t._v("具体实现的话，不能纯手工替换，"),s("strong",[t._v("效率低是其次，更危险的是容易出错")]),t._v("。")]),t._v(" "),s("p",[t._v("这里采用"),s("strong",[t._v("脚本+人工")]),t._v("的方式。脚本用来提取类名以及替换，人工定义新类名，并 "),s("code",[t._v("CR")]),t._v(" 脚本替换后的代码。")]),t._v(" "),s("p",[t._v("主要步骤：")]),t._v(" "),s("ol",[s("li",[t._v("脚本提取 "),s("code",[t._v("Vue")]),t._v(" 文件类名，生成列表")]),t._v(" "),s("li",[t._v("人工给出新旧类名对应关系，尽量一一对应，不要一对多或者多对一，并注意公共样式类名")]),t._v(" "),s("li",[t._v("脚本修改 "),s("code",[t._v("Vue")]),t._v(" 文件，用统一方法替换旧类名，注意这里是向后兼容写法")]),t._v(" "),s("li",[t._v("脚本修改 "),s("code",[t._v("Scss")]),t._v(" 文件，替换旧类名")]),t._v(" "),s("li",[t._v("检查代码，检查示例工程，提交")])]),t._v(" "),s("p",[t._v("映射表示例如下：")]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TIP_CLASS_MAP")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  benefit"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tip-act-welfare-item'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  top"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tip-act-welfare-top'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'shop-icon'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tip-act-welfare-shop-icon'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'shop-name'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tip-act-welfare-shop'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'shop-desc'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tip-act-welfare-range'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("类名获取核心函数如下，优先新类名，支持旧类名：")]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getActClass")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("useTipClass"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tipClassMap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" list "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getClassList")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" tipClasses "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("item "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("item "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" tipClassMap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" pressClasses "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" reg "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RegExp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PREFIX")]),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("reg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PREFIX")]),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("useTipClass"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" pressClasses"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("' '")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("pressClasses"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("tipClasses"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("' '")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"_3-其他"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-其他"}},[t._v("#")]),t._v(" 3. 其他")]),t._v(" "),s("h3",{attrs:{id:"_3-1-tip-style-name"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-tip-style-name"}},[t._v("#")]),t._v(" 3.1. TIP_STYLE_NAME")]),t._v(" "),s("p",[t._v("对于老的关键词编译，Press UI 本次并未改动，依然可以加载一种或多种游戏的样式。")]),t._v(" "),s("p",[t._v("不过，这里没有用 "),s("code",[t._v("@TIP_STYLE_NAME")]),t._v(" 关键词判断是否需要动态切换样式，而是引入了新的 "),s("code",[t._v("base.scss")]),t._v("，下面说下为什么不用老的关键词。")]),t._v(" "),s("p",[s("code",[t._v("@TIP_STYLE_NAME")]),t._v(" 其实是"),s("strong",[t._v("蹩脚的设计")]),t._v("，组件内使用它后，意味着"),s("strong",[t._v("必须搭配一个 "),s("code",[t._v("loader")]),t._v(" 处理")]),t._v("，而 "),s("code",[t._v("base.scss")]),t._v(" 是真实存在的文件，无需引入任何额外工具。另外一些活动组件也没有引入 "),s("code",[t._v("@TIP_STYLE_NAME")]),t._v("。")]),t._v(" "),s("p",[s("strong",[t._v("多游戏的样式替换，完全可以用条件编译")]),t._v("，之前文章也有写。")]),t._v(" "),s("h3",{attrs:{id:"_3-2-组件沉淀规范"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-组件沉淀规范"}},[t._v("#")]),t._v(" 3.2. 组件沉淀规范")]),t._v(" "),s("ol",[s("li",[t._v("文档 props 字段为横杠写法，不能为驼峰")])]),t._v(" "),s("p",[t._v("正确写法：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("参数")]),t._v(" "),s("th",[t._v("说明")]),t._v(" "),s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("默认值")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("show-pic")]),t._v(" "),s("td",[t._v("是否显示图片")]),t._v(" "),s("td",[s("em",[t._v("boolean")])]),t._v(" "),s("td",[s("code",[t._v("false")])])]),t._v(" "),s("tr",[s("td",[t._v("props-data")]),t._v(" "),s("td",[t._v("弹窗数据")]),t._v(" "),s("td",[s("em",[t._v("Object")])]),t._v(" "),s("td",[t._v("-")])]),t._v(" "),s("tr",[s("td",[t._v("show-close-btn")]),t._v(" "),s("td",[t._v("是否显示关闭图标")]),t._v(" "),s("td",[s("em",[t._v("boolean")])]),t._v(" "),s("td",[s("code",[t._v("true")])])])])]),t._v(" "),s("p",[t._v("错误写法：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("参数")]),t._v(" "),s("th",[t._v("说明")]),t._v(" "),s("th",[t._v("类型")]),t._v(" "),s("th",[t._v("默认值")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("showPic")]),t._v(" "),s("td",[t._v("是否显示图片")]),t._v(" "),s("td",[s("em",[t._v("boolean")])]),t._v(" "),s("td",[s("code",[t._v("false")])])]),t._v(" "),s("tr",[s("td",[t._v("propsData")]),t._v(" "),s("td",[t._v("弹窗数据")]),t._v(" "),s("td",[s("em",[t._v("Object")])]),t._v(" "),s("td",[t._v("-")])]),t._v(" "),s("tr",[s("td",[t._v("showCloseBtn")]),t._v(" "),s("td",[t._v("是否显示关闭图标")]),t._v(" "),s("td",[s("em",[t._v("boolean")])]),t._v(" "),s("td",[s("code",[t._v("true")])])])])]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("文档 props 默认值")])]),t._v(" "),s("p",[s("code",[t._v("string/array/object")]),t._v("，默认为空/空数组/空对象时，一律写为"),s("code",[t._v("-")]),t._v("，不要写 "),s("code",[t._v("''")]),t._v("/"),s("code",[t._v("[]")]),t._v("/"),s("code",[t._v("{}")]),t._v("，冗余且没意义。")]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[t._v("复杂对象 props")])]),t._v(" "),s("p",[t._v("必须注明每个字段的类型，如下：")]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IPropsData")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  dialogClass"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 弹窗额外类名")]),t._v("\n  storePic"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 商户图片")]),t._v("\n  storeName"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 商户名称")]),t._v("\n\n  title"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  content"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  subContent"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 额外说明文案")]),t._v("\n  isGold"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("boolean")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// subContent 是否添加 -gold 类名")]),t._v("\n\n  btnText"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 确认按钮文案")]),t._v("\n  cancelBtnText"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 取消按钮文案")]),t._v("\n  btnClass"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 确认按钮额外类名")]),t._v("\n  cancelBtnClass"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 取消按钮额外类名")]),t._v("\n  \n  hasHook"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("boolean")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 是否有对勾Dom")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"_3-3-文档与示例通信"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-文档与示例通信"}},[t._v("#")]),t._v(" 3.3. 文档与示例通信")]),t._v(" "),s("p",[t._v("示例页面切换样式类型后，通过 "),s("code",[t._v("postMessage")]),t._v(" 通知文档更改横竖屏，达到更好的展示效果。")]),t._v(" "),s("p",[t._v("自定义参数中的 Picker，会判断页面高度，自动更改横竖屏类型。")]),t._v(" "),s("h2",{attrs:{id:"_4-打包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-打包"}},[t._v("#")]),t._v(" 4. 打包")]),t._v(" "),s("p",[t._v("Press UI 组件的使用方式一直都是源码方式，也就是在 "),s("code",[t._v("vue.config.js")]),t._v(" 中添加 "),s("code",[t._v("transpileDependencies")]),t._v(" 配置，现在支持了将组件打包成 "),s("code",[t._v("js")]),t._v(" 文件，方便在普通 H5 项目中使用。下面记录下实现方式、遇到的问题及解决办法。")]),t._v(" "),s("p",[t._v("实现上参考了 element-ui 和 vant 的打包，支持每个组件单独打包，以及所有组件打包到一起（all in one），并支持按需加载。")]),t._v(" "),s("p",[t._v("遇到的问题如下：")]),t._v(" "),s("h3",{attrs:{id:"_4-1-font-face"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-font-face"}},[t._v("#")]),t._v(" 4.1. font-face")]),t._v(" "),s("p",[s("code",[t._v("@font-face")]),t._v(" 中的 "),s("code",[t._v("url")]),t._v(" 需要加引号，如果不加的话，在 "),s("code",[t._v("scss")]),t._v(" "),s("code",[t._v("中没问题，css")]),t._v(" 中引入会失败。")]),t._v(" "),s("h3",{attrs:{id:"_4-2-icon-乱码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-icon-乱码"}},[t._v("#")]),t._v(" 4.2. icon 乱码")]),t._v(" "),s("p",[t._v("伪类 "),s("code",[t._v("content")]),t._v(" 中的内容在编码后会变成乱码，尽管在 "),s("code",[t._v("html")]),t._v(" 中可以正常显示，但是在 "),s("code",[t._v("css")]),t._v(" 文件中都是无法预览、无法修改的。")]),t._v(" "),s("p",[t._v("这个问题困扰了挺多人，一些人说是 "),s("code",[t._v("dart-scss")]),t._v(" 的问题，换成 "),s("code",[t._v("node-scss")]),t._v(" 可以解决。这里我直接将这部分 "),s("code",[t._v("icon")]),t._v(" 用 "),s("code",[t._v("css")]),t._v(" 实现了，不用 "),s("code",[t._v("scss")]),t._v("，也解决了这个问题。")]),t._v(" "),s("p",[t._v("参考：")]),t._v(" "),s("ul",[s("li",[t._v("https://webpack.docschina.org/loaders/sass-loader/#sassoptions")]),t._v(" "),s("li",[t._v("https://github.com/PanJiaChen/vue-element-admin/issues/3526")])]),t._v(" "),s("h3",{attrs:{id:"_4-3-css-相关的loader"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-css-相关的loader"}},[t._v("#")]),t._v(" 4.3. css 相关的loader")]),t._v(" "),s("p",[s("code",[t._v("style-loader")]),t._v(" 的作用是在 "),s("code",[t._v("html")]),t._v(" 中插入 "),s("code",[t._v("style")]),t._v(" 标签，单组件分别打包时，也就是和 "),s("code",[t._v("MiniCssExtractPlugin.loader")]),t._v(" 搭配时不需要，如果使用会报错：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("window is not defined\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# or")]),t._v("\ndocument is not defined\n")])])]),s("p",[t._v("参考：")]),t._v(" "),s("ul",[s("li",[t._v("https://github.com/webpack-contrib/style-loader/issues/461")])])])}),[],!1,null,null,null);s.default=e.exports}}]);