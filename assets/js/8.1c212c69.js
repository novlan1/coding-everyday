(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{318:function(t,a,r){"use strict";r.r(a);var o=r(25),n=Object(o.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("ul",[a("li",[a("a",{attrs:{href:"#1-crontab%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98"}},[t._v("1. Crontab相关问题")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#11-%E6%9F%A5%E7%9C%8Bcrontab%E4%BB%BB%E5%8A%A1%E6%98%AF%E5%90%A6%E6%89%A7%E8%A1%8C%E4%BB%A5%E5%8F%8A%E6%89%A7%E8%A1%8C%E6%97%A5%E5%BF%97"}},[t._v("1.1. 查看crontab任务是否执行以及执行日志")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#12-crontab-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E6%8A%A5%E9%94%99-node-command-not-found"}},[t._v("1.2. crontab 定时任务报错 "),a("code",[t._v("node: command not found")])])]),t._v(" "),a("li",[a("a",{attrs:{href:"#13-crontab%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%97%AE%E9%A2%98"}},[t._v("1.3. crontab环境变量问题")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#14-crontab%E5%85%B6%E4%BB%96%E5%BA%94%E8%AF%A5%E6%B3%A8%E6%84%8F%E7%9A%84%E9%97%AE%E9%A2%98"}},[t._v("1.4. crontab其他应该注意的问题")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#15-cron%E5%90%AF%E5%8A%A8"}},[t._v("1.5. cron启动")])])])])]),t._v(" "),a("h2",{attrs:{id:"_1-crontab相关问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-crontab相关问题"}},[t._v("#")]),t._v(" 1. Crontab相关问题")]),t._v(" "),a("h3",{attrs:{id:"_1-1-查看crontab任务是否执行以及执行日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-查看crontab任务是否执行以及执行日志"}},[t._v("#")]),t._v(" 1.1. 查看crontab任务是否执行以及执行日志")]),t._v(" "),a("ol",[a("li",[t._v("查看crontab的日志")])]),t._v(" "),a("ul",[a("li",[t._v("日志文件为"),a("code",[t._v("/var/log/cron")])]),t._v(" "),a("li",[t._v("找到对应时间，是否执行指令")]),t._v(" "),a("li",[t._v("这种方式只能看到是否执行，但是并无法确定是否执行成功")])]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("将定时任务的日志重定向\n日志重定向的时候要注意，要将标准错误日志一起重定向，才能获取到正常和错误的日志")])]),t._v(" "),a("p",[t._v("例如：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[t._v("27")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" * * * /usr/bin/sh /opt/lyy/checkES.sh "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v("/opt/lyy/checkES.log "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("&1")]),t._v("\n")])])]),a("h3",{attrs:{id:"_1-2-crontab-定时任务报错-node-command-not-found"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-crontab-定时任务报错-node-command-not-found"}},[t._v("#")]),t._v(" 1.2. crontab 定时任务报错 "),a("code",[t._v("node: command not found")])]),t._v(" "),a("p",[t._v("脚本没问题，用 sh 命令可以执行，但是定时任务日志显示报错。\n原因：发现是因为缺少环境变量，需要在 crontab 命令中指定环境变量位置，改了命令就可以了。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(" * * "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("-6 /etc/profile"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v(" /root/myjobs/crawerOne/crawAndUpload.sh "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" /root/myjobs/crawerOne/job.log "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("&1")]),t._v("\n")])])]),a("h3",{attrs:{id:"_1-3-crontab环境变量问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-crontab环境变量问题"}},[t._v("#")]),t._v(" 1.3. crontab环境变量问题")]),t._v(" "),a("p",[t._v("crontab总是不会缺省的从用户profile文件中读取环境变量参数，经常导致在手工执行某个脚本时是成功的，但是到crontab中试图让它定期执行时就是会出错。")]),t._v(" "),a("p",[t._v("2种方法可以解决这个问题，主要是让环境变量在crontab中被定义")]),t._v(" "),a("ol",[a("li",[t._v("在Shell文件里面获取环境变量值的路径写成"),a("strong",[t._v("绝对路径")]),t._v("，别用环境变量的路径值。")]),t._v(" "),a("li",[t._v("Shell脚本缺省的#!/bin/sh开头换行后的第一行用（前提是"),a("code",[t._v("profile")]),t._v("和"),a("code",[t._v(".bash_profile")]),t._v("分别存在需要的路径配置）")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("#!/bin/sh \n. /etc/profile \n. ~/.bash_profile \n")])])]),a("p",[t._v("只有crontab在执行脚本的时候能够读到用户的环境变量参数，才能保证定时能正常被执行。")]),t._v(" "),a("h3",{attrs:{id:"_1-4-crontab其他应该注意的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-crontab其他应该注意的问题"}},[t._v("#")]),t._v(" 1.4. crontab其他应该注意的问题")]),t._v(" "),a("ol",[a("li",[t._v("新创建的cron job，"),a("strong",[t._v("不会马上执行，至少要过2分钟才执行")]),t._v("。如果重启cron则马上执行。")]),t._v(" "),a("li",[t._v("每条 JOB 执行完毕之后，系统会自动将输出发送邮件给当前系统用户。日积月累，非常的多，甚至会撑爆整个系统。所以每条 JOB 命令后面进行重定向处理是非常必要的： "),a("strong",[a("code",[t._v(">/dev/null 2>&1")])]),t._v("。前提是对 Job 中的命令需要正常输出已经作了一定的处理, 比如追加到某个特定日志文件。")]),t._v(" "),a("li",[t._v("当"),a("code",[t._v("crontab")]),t._v("突然失效时，可以"),a("strong",[t._v("尝试"),a("code",[t._v("/etc/init.d/crond restart")]),t._v("解决问题")]),t._v("。或者查看日志看某个job有没有"),a("strong",[t._v("执行/报错"),a("code",[t._v("tail -f /var/log/cron")]),t._v("。")])]),t._v(" "),a("li",[t._v("千万别乱运行"),a("code",[t._v("crontab -r")]),t._v("。它从Crontab目录（"),a("code",[t._v("/var/spool/cron")]),t._v("）中删除用户的"),a("code",[t._v("Crontab")]),t._v("文件。删除了该用户的所有crontab都没了。")]),t._v(" "),a("li",[a("strong",[t._v("在"),a("code",[t._v("crontab")]),t._v("中"),a("code",[t._v("%")]),t._v("是有特殊含义的，表示换行的意思")]),t._v("。如果要用的话必须进行转义"),a("code",[t._v("\\%")]),t._v("，如经常用的"),a("code",[t._v("date ‘+%Y%m%d’")]),t._v("在"),a("code",[t._v("crontab")]),t._v("里是不会执行的，应该换成"),a("code",[t._v("date ‘+\\%Y\\%m\\%d’")]),t._v("。")])]),t._v(" "),a("h3",{attrs:{id:"_1-5-cron启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-cron启动"}},[t._v("#")]),t._v(" 1.5. cron启动")]),t._v(" "),a("p",[t._v("cron服务是Linux的内置服务，但它不会开机自动启动。可以用以下命令启动和停止服务：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("/sbin/service crond start \n/sbin/service crond stop \n/sbin/service crond restart \n/sbin/service crond reload \n")])])]),a("p",[t._v("以上1-4行分别为启动、停止、重启服务和重新加载配置。\n要把cron设为在开机的时候自动启动，在 "),a("code",[t._v("/etc/rc.d/rc.local")]),t._v(" 脚本中加入 "),a("code",[t._v("/sbin/service crond start")]),t._v(" 即可")]),t._v(" "),a("ul",[a("li",[t._v("查看当前用户的crontab，输入 "),a("code",[t._v("crontab -l")]),t._v("；")]),t._v(" "),a("li",[t._v("编辑crontab，输入 "),a("code",[t._v("crontab -e")]),t._v("；")]),t._v(" "),a("li",[t._v("删除crontab，输入 "),a("code",[t._v("crontab -r")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);