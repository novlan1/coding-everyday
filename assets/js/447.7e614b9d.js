(window.webpackJsonp=window.webpackJsonp||[]).push([[447],{722:function(t,s,a){"use strict";a.r(s);var n=a(14),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("[TOC]")]),t._v(" "),s("h2",{attrs:{id:"_1-开始"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-开始"}},[t._v("#")]),t._v(" 1. 开始")]),t._v(" "),s("p",[t._v("经常看见一些地方说某些npm包存在漏洞，具体是哪里有漏洞呢，会危害到哪方面呢，是以什么方式造成的呢？")]),t._v(" "),s("p",[t._v("我十分好奇，决定一探究竟，本文用来记录npm包漏洞的内部原因，会持续更新。")]),t._v(" "),s("h2",{attrs:{id:"_2-glob-parent"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-glob-parent"}},[t._v("#")]),t._v(" 2. glob-parent")]),t._v(" "),s("p",[t._v("这个包的作用是在glob表达式中，提取非魔法字符串的部分，比如：")]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" globParent "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'glob-parent'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("globParent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'path/to/*.js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 'path/to'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("globParent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/root/path/to/*.js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// '/root/path/to'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("globParent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/*.js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// '/'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("globParent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*.js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// '.'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("globParent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'**/*.js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// '.'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("globParent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'path/{to,from}'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 'path'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("globParent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'path/!(to|from)'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 'path'")]),t._v("\n")])])]),s("p",[t._v("这个包被"),s("code",[t._v("webpack-dev-server")]),t._v("、"),s("code",[t._v("chokidar")]),t._v("、"),s("code",[t._v("eslint")]),t._v("等流行库使用。")]),t._v(" "),s("p",[t._v("该库在"),s("code",[t._v("<5.1.2")]),t._v("前有ReDos(Denial of service)攻击风险，个人理解就是会让执行变慢，攻击者可以使用特殊文件或字符，使服务器不能正常工作。")]),t._v(" "),s("p",[t._v("漏洞前的代码：")]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" enclosure "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token regex"}},[s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("[\\{\\[].*[\\/]*.*[\\}\\]]$")]),s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("修复后的代码：")]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" enclosure "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token regex"}},[s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("[\\{\\[].*[\\}\\]]$")]),s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("如何检测呢，如果下面的测试用例超时，则说明存在ReDoc风险。")]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("it")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'should not be susceptible to SNYK-JS-GLOBPARENT-1016905'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("done"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// This will time out if susceptible.")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("gp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("repeat")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("done")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("根本原因是正则的回溯原理，也就是"),s("code",[t._v(".*")]),t._v("已经包含了"),s("code",[t._v("[\\/]*")]),t._v("，没必要再用"),s("code",[t._v("[\\/]*.*")]),t._v("了，具体的执行步骤差异不是成倍，而是指数级的。")]),t._v(" "),s("p",[t._v("可以用"),s("a",{attrs:{href:"https://regex101.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("这个网站"),s("OutboundLink")],1),t._v("查看两个正则解析的性能差异，上面的测试用例，修复前执行时间超过"),s("code",[t._v("2s")]),t._v("，修复后执行只需要"),s("code",[t._v("0.8ms")]),t._v("。")]),t._v(" "),s("p",[t._v("下面是一些思考，其实我们自己写代码时，也有可能写出性能极差的正则，但是并不会被漏洞检测机构收录，可能是因为我们写的库用途不广，并不是基础库，没有被大型项目使用。")]),t._v(" "),s("p",[t._v("参考:")]),t._v(" "),s("ul",[s("li",[t._v("https://nvd.nist.gov/vuln/detail/CVE-2020-28469")]),t._v(" "),s("li",[t._v("https://security.snyk.io/vuln/SNYK-JS-GLOBPARENT-1016905")]),t._v(" "),s("li",[t._v("https://regex101.com/")]),t._v(" "),s("li",[t._v("https://github.com/gulpjs/glob-parent/issues/32")]),t._v(" "),s("li",[t._v("https://github.com/gulpjs/glob-parent/pull/36/commits/c6db86422a9731d4f3d332ce4a81c27ea6b0ee46")])]),t._v(" "),s("h2",{attrs:{id:"_3-xlsx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-xlsx"}},[t._v("#")]),t._v(" 3. xlsx")]),t._v(" "),s("p",[t._v("这个包"),s("code",[t._v("<0.19.3")]),t._v("的版本都有原型污染的漏洞，另外这个库已经不在"),s("code",[t._v("github")]),t._v("和"),s("code",[t._v("npm")]),t._v("上更新了，需要这样更新：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("npm i https://cdn.sheetjs.com/xlsx-0.19.3/xlsx-0.19.3.tgz\n")])])]),s("p",[t._v("看了下代码，并没有找到相关的漏洞修复提交记录，不知道是不是换了个源，人们就认为它修复了呢？")]),t._v(" "),s("p",[t._v("参考:")]),t._v(" "),s("ul",[s("li",[t._v("https://nvd.nist.gov/vuln/detail/CVE-2023-30533")]),t._v(" "),s("li",[t._v("https://cdn.sheetjs.com/advisories/CVE-2023-30533")]),t._v(" "),s("li",[t._v("https://git.sheetjs.com/sheetjs/sheetjs/src/branch/master/CHANGELOG.md")]),t._v(" "),s("li",[t._v("https://git.sheetjs.com/sheetjs/sheetjs/issues/2667")]),t._v(" "),s("li",[t._v("https://github.com/advisories/GHSA-4r6h-8v6p-xvw6")]),t._v(" "),s("li",[t._v("https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html")])]),t._v(" "),s("h2",{attrs:{id:"_4-file-type"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-file-type"}},[t._v("#")]),t._v(" 4. file-type")]),t._v(" "),s("p",[t._v("这个包也是会引起Dos攻击，原因是读取 MKV 文件的时候处理不当，会造成无限循环。")]),t._v(" "),s("p",[t._v("有问题的版本为"),s("code",[t._v(">= 17.0.0, < 17.1.3")]),t._v("和"),s("code",[t._v(">= 13.0.0, < 16.5.4")]),t._v("，修复的版本为"),s("code",[t._v("17.1.3")]),t._v("和"),s("code",[t._v("16.5.4")]),t._v("。")]),t._v(" "),s("p",[t._v("参考：")]),t._v(" "),s("ul",[s("li",[t._v("https://nvd.nist.gov/vuln/detail/CVE-2022-36313")]),t._v(" "),s("li",[t._v("https://github.com/sindresorhus/file-type/releases/tag/v16.5.4")]),t._v(" "),s("li",[t._v("https://github.com/sindresorhus/file-type/releases/tag/v17.1.3")]),t._v(" "),s("li",[t._v("https://www.npmjs.com/package/file-type")]),t._v(" "),s("li",[t._v("https://github.com/sindresorhus/file-type/commit/2c4d1200c99dffb7d515b9b9951ef43c22bf7e47")]),t._v(" "),s("li",[t._v("https://github.com/sindresorhus/file-type/commit/d86835680f4cccbee1a60628783c36700ec9e254")]),t._v(" "),s("li",[t._v("https://github.com/sindresorhus/file-type/commit/8f981c32e2750d2516457e305e502ee2ad715759#diff-c853b2249e99790d8725774cf63c90c5ab17112067df6e267f3701d7bf591d12")]),t._v(" "),s("li",[t._v("https://github.com/sindresorhus/file-type/compare/v12.4.2...v13.0.0#diff-c853b2249e99790d8725774cf63c90c5ab17112067df6e267f3701d7bf591d12R611-R613")]),t._v(" "),s("li",[t._v("https://security.snyk.io/vuln/SNYK-JS-FILETYPE-2958042")]),t._v(" "),s("li",[t._v("https://security.netapp.com/advisory/ntap-20220909-0005/")]),t._v(" "),s("li",[t._v("https://github.com/advisories/GHSA-mhxj-85r3-2x55")])]),t._v(" "),s("h2",{attrs:{id:"_5-ejs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-ejs"}},[t._v("#")]),t._v(" 5. ejs")]),t._v(" "),s("p",[t._v("ejs是个模版解析工具，被express等库使用。")]),t._v(" "),s("p",[t._v("首先它本身是个javascript运行时工具，开发者需要自己对数据进行校验后再进行下一步处理或输出，不能这样：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" express "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'express'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("express")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PORT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\napp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'views'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" __dirname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\napp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'view engine'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ejs'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\napp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'index'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\napp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PORT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("Server is running on ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PORT")]),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("有关ejs本身的漏洞是这样的，在query中的参数没被过滤，可以直接运行，造成RCE（远程代码执行"),s("code",[t._v("remote command/code execute")]),t._v("）攻击。")]),t._v(" "),s("p",[t._v("有问题的版本为"),s("code",[t._v("< 3.1.7")]),t._v("，修复的版本为"),s("code",[t._v(">= 3.1.7")]),t._v("。")]),t._v(" "),s("p",[t._v("参考：")]),t._v(" "),s("ul",[s("li",[t._v("https://nvd.nist.gov/vuln/detail/CVE-2022-29078")]),t._v(" "),s("li",[t._v("https://eslam.io/posts/ejs-server-side-template-injection-rce/")]),t._v(" "),s("li",[t._v("https://github.com/mde/ejs/commit/15ee698583c98dadc456639d6245580d17a24baf")]),t._v(" "),s("li",[t._v("https://github.com/mde/ejs/releases")]),t._v(" "),s("li",[t._v("https://security.netapp.com/advisory/ntap-20220804-0001/")]),t._v(" "),s("li",[t._v("https://github.com/advisories/GHSA-phwq-j96m-2c2q")])]),t._v(" "),s("h2",{attrs:{id:"_6-qs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-qs"}},[t._v("#")]),t._v(" 6. qs")]),t._v(" "),s("p",[t._v("qs是字符串解析库，使用非常广泛。")]),t._v(" "),s("p",[t._v("关于它的一个漏洞也是原型污染类的，因为它可以用来解析对象，解决办法也很简单，就是过滤"),s("code",[t._v("__proto__")]),t._v("属性即可。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("影响版本")]),t._v(" "),s("th",[t._v("修复版本")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v(">= 6.10.0, < 6.10.3")]),t._v(" "),s("td",[t._v("6.10.3")])]),t._v(" "),s("tr",[s("td",[t._v(">= 6.9.0, < 6.9.7")]),t._v(" "),s("td",[t._v("6.9.7")])]),t._v(" "),s("tr",[s("td",[t._v(">= 6.8.0, < 6.8.3")]),t._v(" "),s("td",[t._v("6.8.3")])]),t._v(" "),s("tr",[s("td",[t._v(">= 6.7.0, < 6.7.3")]),t._v(" "),s("td",[t._v("6.7.3")])]),t._v(" "),s("tr",[s("td",[t._v(">= 6.6.0, < 6.6.1")]),t._v(" "),s("td",[t._v("6.6.1")])]),t._v(" "),s("tr",[s("td",[t._v(">= 6.5.0, < 6.5.3")]),t._v(" "),s("td",[t._v("6.5.3")])]),t._v(" "),s("tr",[s("td",[t._v(">= 6.4.0, < 6.4.1")]),t._v(" "),s("td",[t._v("6.4.1")])]),t._v(" "),s("tr",[s("td",[t._v(">= 6.3.0, < 6.3.3")]),t._v(" "),s("td",[t._v("6.3.3")])]),t._v(" "),s("tr",[s("td",[t._v("< 6.2.4")]),t._v(" "),s("td",[t._v("6.2.4")])])])]),t._v(" "),s("p",[t._v("参考：")]),t._v(" "),s("ul",[s("li",[t._v("https://nvd.nist.gov/vuln/detail/CVE-2022-24999")]),t._v(" "),s("li",[t._v("https://github.com/ljharb/qs/pull/428")]),t._v(" "),s("li",[t._v("https://github.com/n8tz/CVE-2022-24999")]),t._v(" "),s("li",[t._v("https://github.com/ljharb/qs/commit/4310742efbd8c03f6495f07906b45213da0a32ec")]),t._v(" "),s("li",[t._v("https://github.com/ljharb/qs/commit/727ef5d34605108acb3513f72d5435972ed15b68")]),t._v(" "),s("li",[t._v("https://github.com/ljharb/qs/commit/73205259936317b40f447c5cdb71c5b341848e1b")]),t._v(" "),s("li",[t._v("https://github.com/ljharb/qs/commit/8b4cc14cda94a5c89341b77e5fe435ec6c41be2d")]),t._v(" "),s("li",[t._v("https://github.com/ljharb/qs/commit/ba24e74dd17931f825adb52f5633e48293b584e1")]),t._v(" "),s("li",[t._v("https://github.com/ljharb/qs/commit/e799ba57e573a30c14b67c1889c7c04d508b9105")]),t._v(" "),s("li",[t._v("https://github.com/ljharb/qs/commit/ed0f5dcbef4b168a8ae299d78b1e4a2e9b1baf1f")]),t._v(" "),s("li",[t._v("https://github.com/ljharb/qs/commit/f945393cfe442fe8c6e62b4156fd35452c0686ee")]),t._v(" "),s("li",[t._v("https://github.com/ljharb/qs/commit/fc3682776670524a42e19709ec4a8138d0d7afda")]),t._v(" "),s("li",[t._v("https://github.com/expressjs/express/releases/tag/4.17.3")]),t._v(" "),s("li",[t._v("https://lists.debian.org/debian-lts-announce/2023/01/msg00039.html")]),t._v(" "),s("li",[t._v("https://github.com/advisories/GHSA-hrpp-h998-j3pp")])]),t._v(" "),s("p",[t._v("----- 2024.12.19 更新 ------")]),t._v(" "),s("h2",{attrs:{id:"_7-vant"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-vant"}},[t._v("#")]),t._v(" 7. vant")]),t._v(" "),s("p",[t._v("亲身经历。")]),t._v(" "),s("p",[t._v("有发布权限的人发布了 "),s("a",{attrs:{href:"https://www.npmjs.com/package/vant/v/2.13.5",target:"_blank",rel:"noopener noreferrer"}},[t._v("vant@2.13.5"),s("OutboundLink")],1),t._v("，带了一个恶意程序 "),s("code",[t._v("lib/utils/support.js")]),t._v("，并增加了 "),s("code",[t._v("postinstall")]),t._v(" 脚本命令，用户安装"),s("code",[t._v("vant")]),t._v("后，就会自动执行这个文件，然后在构建机挖矿。")]),t._v(" "),s("p",[t._v("影响范围："),s("code",[t._v("vant")]),t._v(" 被投毒后、未删之前期间，"),s("code",[t._v("package.json")]),t._v(" 未锁定版本，从 "),s("code",[t._v("npm")]),t._v(" 官方源下载 "),s("code",[t._v("vant")]),t._v(" 的用户。")]),t._v(" "),s("p",[t._v("解决办法：")]),t._v(" "),s("ol",[s("li",[t._v("官方删除有问题版本（已删除）")]),t._v(" "),s("li",[t._v("构建机重装")]),t._v(" "),s("li",[t._v("锁定版本号，避免出现类似问题")])]),t._v(" "),s("p",[t._v("相关链接：https://github.com/youzan/vant/discussions/13273")])])}),[],!1,null,null,null);s.default=e.exports}}]);