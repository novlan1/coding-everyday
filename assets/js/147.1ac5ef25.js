(window.webpackJsonp=window.webpackJsonp||[]).push([[147],{452:function(t,_,e){"use strict";e.r(_);var v=e(25),a=Object(v.a)({},(function(){var t=this,_=t._self._c;return _("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[_("ul",[_("li",[_("a",{attrs:{href:"#1-next-%E4%B8%AD%E5%B8%B8%E8%A7%81%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%9C%E7%94%A8"}},[t._v("1. Next 中常见文件的作用")])]),t._v(" "),_("li",[_("a",{attrs:{href:"#2-next-%E8%B7%AF%E7%94%B1%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B0"}},[t._v("2. Next 路由传递参数")])]),t._v(" "),_("li",[_("a",{attrs:{href:"#3-%E8%87%AA%E5%AE%9A%E4%B9%89app%E4%BD%9C%E7%94%A8"}},[t._v("3. 自定义APP作用")])]),t._v(" "),_("li",[_("a",{attrs:{href:"#4-%E8%87%AA%E5%AE%9A%E4%B9%89-document"}},[t._v("4. 自定义 Document")])]),t._v(" "),_("li",[_("a",{attrs:{href:"#5-%E5%BC%82%E6%AD%A5%E7%BB%84%E4%BB%B6%E7%9A%84%E5%8A%A0%E8%BD%BD-%E7%AD%89%E5%88%B0%E4%BA%86%E8%B0%83%E5%88%B0%E5%AE%83%E7%9A%84%E5%9C%B0%E6%96%B9%E5%86%8D%E5%8A%A0%E8%BD%BD"}},[t._v("5. 异步组件的加载, 等到了调到它的地方再加载")])]),t._v(" "),_("li",[_("a",{attrs:{href:"#6-next-%E9%9B%86%E6%88%90-redux-%E9%9C%80%E8%A6%81%E8%80%83%E8%99%91"}},[t._v("6. Next 集成 redux 需要考虑")])]),t._v(" "),_("li",[_("a",{attrs:{href:"#7-next-%E6%B5%81%E7%A8%8B"}},[t._v("7. Next 流程")])]),t._v(" "),_("li",[_("a",{attrs:{href:"#8-next-%E9%9B%86%E6%88%90redux"}},[t._v("8. Next 集成redux")])]),t._v(" "),_("li",[_("a",{attrs:{href:"#9-withrouter"}},[t._v("9. "),_("code",[t._v("withRouter")])])]),t._v(" "),_("li",[_("a",{attrs:{href:"#10-next_data%E5%B1%9E%E6%80%A7"}},[t._v("10. "),_("code",[t._v("next_data")]),t._v("属性")])]),t._v(" "),_("li",[_("a",{attrs:{href:"#11-%E5%85%B3%E4%BA%8Egetinitialprops%E6%96%B9%E6%B3%95"}},[t._v("11. 关于"),_("code",[t._v("getInitialProps")]),t._v("方法")]),t._v(" "),_("ul",[_("li",[_("a",{attrs:{href:"#111-%E9%82%A3%E4%B9%88getinitialprops-%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E4%BC%9A%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E7%AB%AF%E8%B0%83%E7%94%A8%E5%91%A2"}},[t._v("11.1. 那么，"),_("code",[t._v("getInitialProps")]),t._v(" 什么时候会在浏览器端调用呢？")])])])]),t._v(" "),_("li",[_("a",{attrs:{href:"#12-getinitialprops%E5%85%A5%E5%8F%82%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%B1%9E%E6%80%A7%E5%A6%82%E4%B8%8B"}},[t._v("12. getInitialProps入参对象的属性如下：")])]),t._v(" "),_("li",[_("a",{attrs:{href:"#13-ssr%E9%A1%B9%E7%9B%AE%E5%BC%95%E5%85%A5%E7%BB%84%E4%BB%B6%E6%8F%90%E7%A4%BAwindow%E6%9C%AA%E5%AE%9A%E4%B9%89"}},[t._v("13. SSR项目引入组件，提示"),_("code",[t._v("window")]),t._v("未定义")])])]),t._v(" "),_("h3",{attrs:{id:"_1-next-中常见文件的作用"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_1-next-中常见文件的作用"}},[t._v("#")]),t._v(" 1. Next 中常见文件的作用")]),t._v(" "),_("ul",[_("li",[_("code",[t._v("next.config.js")]),t._v("："),_("code",[t._v("next.js")]),t._v("的配置文件")]),t._v(" "),_("li",[_("code",[t._v("_app.js")]),t._v("：覆盖"),_("code",[t._v("next")]),t._v("的"),_("code",[t._v("app.js")])]),t._v(" "),_("li",[_("code",[t._v("@zeit/next-css")]),t._v("："),_("code",[t._v("next")]),t._v("中加载"),_("code",[t._v("css")])])]),t._v(" "),_("h3",{attrs:{id:"_2-next-路由传递参数"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-next-路由传递参数"}},[t._v("#")]),t._v(" 2. Next 路由传递参数")]),t._v(" "),_("p",[t._v("Next路由传递参数，只能通过"),_("code",[t._v("query")]),t._v("("),_("code",[t._v("b?id=1")]),t._v(")，不能"),_("code",[t._v("params")]),t._v("("),_("code",[t._v("/b/id/1")]),t._v(")，但是可以通过路由映射，"),_("code",[t._v("as='/b/1'")]),t._v("，使URL好看")]),t._v(" "),_("h3",{attrs:{id:"_3-自定义app作用"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_3-自定义app作用"}},[t._v("#")]),t._v(" 3. 自定义APP作用")]),t._v(" "),_("ol",[_("li",[t._v("固定"),_("code",[t._v("layout")])]),t._v(" "),_("li",[t._v("保持一些公用的状态")]),t._v(" "),_("li",[t._v("给页面传入一些自定义数据")]),t._v(" "),_("li",[t._v("自定义错误处理")])]),t._v(" "),_("p",[t._v("注意：自定义"),_("code",[t._v("App")]),t._v("，必须重写APP的"),_("code",[t._v("getIntialProps")]),t._v("方法")]),t._v(" "),_("h3",{attrs:{id:"_4-自定义-document"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_4-自定义-document"}},[t._v("#")]),t._v(" 4. 自定义 Document")]),t._v(" "),_("ul",[_("li",[_("p",[t._v("只有在服务端渲染的时候才会执行")])]),t._v(" "),_("li",[_("p",[t._v("用来修改服务端渲染的文档内容")])]),t._v(" "),_("li",[_("p",[t._v("一般用来配合第三方"),_("code",[t._v("css-in-js")]),t._v("方案使用")])]),t._v(" "),_("li",[_("p",[t._v("要么不覆盖"),_("code",[t._v("Document")]),t._v("的"),_("code",[t._v("getInitialProps")]),t._v("，要么至少将"),_("code",[t._v("Document")]),t._v("的"),_("code",[t._v("getInitialProps")]),t._v("结果返回出去，不要忘了传参"),_("code",[t._v("ctx")]),t._v("。")])]),t._v(" "),_("li",[_("p",[t._v("对于"),_("code",[t._v("render")]),t._v("函数也一样，要么不覆盖，要么就要写出"),_("code",[t._v("Html")]),t._v("、"),_("code",[t._v("Head")]),t._v("、"),_("code",[t._v("body")]),t._v("、"),_("code",[t._v("Main")]),t._v("、"),_("code",[t._v("NextScript")]),t._v("结构，否则缺失。")])])]),t._v(" "),_("p",[t._v("不推荐在"),_("code",[t._v("_document.js")]),t._v("中定义"),_("code",[t._v("title")]),t._v("，应该在"),_("code",[t._v("pages")]),t._v("每个页面引入"),_("code",[t._v("Head")]),t._v("，然后定义"),_("code",[t._v("title")])]),t._v(" "),_("p",[_("code",[t._v("babel-plugin-styled-components，ssr：true")]),t._v("：客户端和服务端生成的"),_("code",[t._v("css")]),t._v("名字一样")]),t._v(" "),_("h3",{attrs:{id:"_5-异步组件的加载-等到了调到它的地方再加载"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_5-异步组件的加载-等到了调到它的地方再加载"}},[t._v("#")]),t._v(" 5. 异步组件的加载, 等到了调到它的地方再加载")]),t._v(" "),_("div",{staticClass:"language- extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[t._v("import dynamic from 'next/dynamic'\n\nconst Comp = dynamic(import('components/test'))\n")])])]),_("p",[t._v("异步模块加载的意思是，等到进入某个页面再加载js，而不是一上来全都加载了。")]),t._v(" "),_("p",[t._v("比如在"),_("code",[t._v("getInitialProps")]),t._v("方法中，"),_("code",[t._v("const moment = await import('moment')")]),t._v("，然后"),_("code",[t._v("moment.default...")])]),t._v(" "),_("h3",{attrs:{id:"_6-next-集成-redux-需要考虑"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_6-next-集成-redux-需要考虑"}},[t._v("#")]),t._v(" 6. Next 集成 redux 需要考虑")]),t._v(" "),_("ul",[_("li",[t._v("服务端如何写入数据到"),_("code",[t._v("store")])]),t._v(" "),_("li",[t._v("如何同步服务端的数据到客户端")])]),t._v(" "),_("h3",{attrs:{id:"_7-next-流程"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_7-next-流程"}},[t._v("#")]),t._v(" 7. Next 流程")]),t._v(" "),_("p",[_("img",{attrs:{src:"/imgs/nextjs_process.jpg",alt:"Next 流程"}})]),t._v(" "),_("h3",{attrs:{id:"_8-next-集成redux"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_8-next-集成redux"}},[t._v("#")]),t._v(" 8. Next 集成redux")]),t._v(" "),_("ol",[_("li",[t._v("主要在于"),_("code",[t._v("lib/with-redux-store.js")]),t._v("和"),_("code",[t._v("_app.js")])]),t._v(" "),_("li",[_("code",[t._v("withRedux")]),t._v("包裹 App，其本身也有"),_("code",[t._v("getInitialProps")]),t._v("法，在此方法中"),_("code",[t._v("getOrCreateStore")]),t._v("，注意 "),_("code",[t._v("server")]),t._v("端和"),_("code",[t._v("client")]),t._v("端不一样的逻辑，服务端每次都"),_("code",[t._v("initializeStore")]),t._v("，防止不同用户共用数据，客户端需要看之前有没有")])]),t._v(" "),_("h3",{attrs:{id:"_9-withrouter"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_9-withrouter"}},[t._v("#")]),t._v(" 9. "),_("code",[t._v("withRouter")])]),t._v(" "),_("ul",[_("li",[t._v("用"),_("code",[t._v("withRouter")]),t._v("包裹，就可以在组件中获得"),_("code",[t._v("router")]),t._v("对象，其上有"),_("code",[t._v("pathnane")]),t._v("、"),_("code",[t._v("query")]),t._v("等属性")]),t._v(" "),_("li",[_("code",[t._v("withRouter")]),t._v("包裹在"),_("code",[t._v("connect")]),t._v("外面，否则与"),_("code",[t._v("withRouter")]),t._v("的"),_("code",[t._v("shouldComponentUpdate")]),t._v("冲突，引起错误。")])]),t._v(" "),_("h3",{attrs:{id:"_10-next-data属性"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_10-next-data属性"}},[t._v("#")]),t._v(" 10. "),_("code",[t._v("next_data")]),t._v("属性")]),t._v(" "),_("p",[_("code",[t._v("next")]),t._v("服务端渲染的时候，"),_("code",[t._v("getInitialProps")]),t._v("把数据放在"),_("code",[t._v("html")]),t._v("的"),_("code",[t._v("next_data")]),t._v("属性中，在客户端第一次渲染的时候不会重新请求，从而保证数据同步")]),t._v(" "),_("h3",{attrs:{id:"_11-关于getinitialprops方法"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_11-关于getinitialprops方法"}},[t._v("#")]),t._v(" 11. 关于"),_("code",[t._v("getInitialProps")]),t._v("方法")]),t._v(" "),_("p",[t._v("Next.js 在做服务器端渲染的时候，页面对应的 React 组件的 "),_("code",[t._v("getInitialProps")]),t._v(" 函数被调用，异步结果就是“脱水”数据的重要部分，"),_("strong",[t._v("除了传给页面 React 组件完成渲染，还放在内嵌 "),_("code",[t._v("script")]),t._v(" 的 "),_("code",[t._v("__NEXT_DATA__")]),t._v(" 中")]),t._v("。")]),t._v(" "),_("p",[_("strong",[t._v("在浏览器端渲染的时候，不会去调用 "),_("code",[t._v("getInitialProps")])]),t._v(" ，直接通过 "),_("code",[t._v("__NEXT_DATA__")]),t._v(" 中的“脱水”数据来启动页面 React 组件的渲染。这样一来，如果 "),_("code",[t._v("getInitialProps")]),t._v(" 中有调用 API 的异步操作，只在服务器端做一次，浏览器端就不用做了。")]),t._v(" "),_("h4",{attrs:{id:"_11-1-那么-getinitialprops-什么时候会在浏览器端调用呢"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_11-1-那么-getinitialprops-什么时候会在浏览器端调用呢"}},[t._v("#")]),t._v(" 11.1. 那么，"),_("code",[t._v("getInitialProps")]),t._v(" 什么时候会在浏览器端调用呢？")]),t._v(" "),_("p",[t._v("当在单页应用中做页面切换的时候，比如从 "),_("code",[t._v("Home")]),t._v(" 页切换到 "),_("code",[t._v("Product")]),t._v(" 页，这时候完全和服务器端没关系，只能靠浏览器端自己了，"),_("code",[t._v("Product")]),t._v("页面的 "),_("code",[t._v("getInitialProps")]),t._v(" 函数就会在浏览器端被调用，得到的数据用来开启页面的 React 原生生命周期过程。")]),t._v(" "),_("h3",{attrs:{id:"_12-getinitialprops入参对象的属性如下"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_12-getinitialprops入参对象的属性如下"}},[t._v("#")]),t._v(" 12. getInitialProps入参对象的属性如下：")]),t._v(" "),_("div",{staticClass:"language-js extra-class"},[_("pre",{pre:!0,attrs:{class:"language-js"}},[_("code",[t._v("pathname   "),_("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// URL 的 path 部分")]),t._v("\nquery   "),_("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// URL 的 query 部分，并被解析成对象")]),t._v("\nasPath   "),_("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 显示在浏览器中的实际路径（包含查询部分），为String类型")]),t._v("\nreq   "),_("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// HTTP 请求对象 (只有服务器端有)")]),t._v("\nres   "),_("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// HTTP 返回对象 (只有服务器端有)")]),t._v("\njsonPageRes   "),_("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取数据响应对象 (只有客户端有)")]),t._v("\nerr   "),_("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 渲染过程中的任何错误")]),t._v("\n")])])]),_("h3",{attrs:{id:"_13-ssr项目引入组件-提示window未定义"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_13-ssr项目引入组件-提示window未定义"}},[t._v("#")]),t._v(" 13. SSR项目引入组件，提示"),_("code",[t._v("window")]),t._v("未定义")]),t._v(" "),_("ol",[_("li",[t._v("用动态导入，"),_("code",[t._v("nextjs")]),t._v("的"),_("code",[t._v("dynaimic")])]),t._v(" "),_("li",[t._v("先定义变量，判断"),_("code",[t._v("window")]),t._v("存在的时候才引入。实践证明，这种方法好用，比如"),_("code",[t._v("braft-editor")])])])])}),[],!1,null,null,null);_.default=a.exports}}]);