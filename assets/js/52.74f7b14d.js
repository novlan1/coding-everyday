(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{435:function(o,e,_){o.exports=_.p+"assets/img/set_cookie.385a8c87.jpg"},653:function(o,e,_){"use strict";_.r(e);var v=_(42),s=Object(v.a)({},(function(){var o=this,e=o.$createElement,v=o._self._c||e;return v("ContentSlotsDistributor",{attrs:{"slot-key":o.$parent.slotKey}},[v("ul",[v("li",[v("a",{attrs:{href:"#1-cookie-%E5%92%8C-session"}},[o._v("1. "),v("code",[o._v("cookie")]),o._v(" 和 "),v("code",[o._v("session")])]),o._v(" "),v("ul",[v("li",[v("a",{attrs:{href:"#11-cookie"}},[o._v("1.1. cookie")]),o._v(" "),v("ul",[v("li",[v("a",{attrs:{href:"#111-cookie%E5%B1%9E%E6%80%A7"}},[o._v("1.1.1. "),v("code",[o._v("cookie")]),o._v("属性")])])])]),o._v(" "),v("li",[v("a",{attrs:{href:"#12-session"}},[o._v("1.2. session")]),o._v(" "),v("ul",[v("li",[v("a",{attrs:{href:"#121-sesssion-%E4%B8%8E-cookie-%E7%9A%84%E5%8C%BA%E5%88%AB"}},[o._v("1.2.1. sesssion 与 cookie 的区别")])])])]),o._v(" "),v("li",[v("a",{attrs:{href:"#13-session%E5%92%8Ctoken"}},[o._v("1.3. "),v("code",[o._v("session")]),o._v("和"),v("code",[o._v("token")])]),o._v(" "),v("ul",[v("li",[v("a",{attrs:{href:"#131-token%E8%BF%87%E7%A8%8B"}},[o._v("1.3.1. "),v("code",[o._v("token")]),o._v("过程")])]),o._v(" "),v("li",[v("a",{attrs:{href:"#132-session%E5%92%8Ctoken%E7%9A%84%E5%8C%BA%E5%88%AB"}},[o._v("1.3.2. "),v("code",[o._v("session")]),o._v("和"),v("code",[o._v("token")]),o._v("的区别")])]),o._v(" "),v("li",[v("a",{attrs:{href:"#133-token%E5%8F%AF%E4%BB%A5%E6%8A%B5%E6%8A%97csrfcookiesession%E4%B8%8D%E8%A1%8C"}},[o._v("1.3.3. "),v("code",[o._v("token")]),o._v("可以抵抗CSRF，"),v("code",[o._v("cookie+session")]),o._v("不行")])])])])])])]),o._v(" "),v("h2",{attrs:{id:"_1-cookie-和-session"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-cookie-和-session"}},[o._v("#")]),o._v(" 1. "),v("code",[o._v("cookie")]),o._v(" 和 "),v("code",[o._v("session")])]),o._v(" "),v("p",[o._v("本来"),v("code",[o._v("session")]),o._v("是一个"),v("strong",[o._v("抽象概念")]),o._v("，开发者为了实现中断和继续等操作，将"),v("code",[o._v("user agent")]),o._v("和"),v("code",[o._v("server")]),o._v("之间一对一的交互，抽象为“会话”，进而衍生出“会话状态”，也就是"),v("code",[o._v("session")]),o._v("的概念。")]),o._v(" "),v("p",[o._v("而"),v("code",[o._v("cookie")]),o._v("是一个"),v("strong",[o._v("实际存在")]),o._v("的东西，http 协议中定义在 "),v("code",[o._v("header")]),o._v(" 中的字段。可以认为是 "),v("code",[o._v("session")]),o._v("的一种后端无状态实现。")]),o._v(" "),v("p",[o._v("而我们今天常说的 “session”，是为了绕开 cookie 的各种限制，通常"),v("strong",[o._v("借助 cookie 本身")]),o._v("和"),v("strong",[o._v("后端存储")]),o._v("实现的，一种更高级的会话状态实现。")]),o._v(" "),v("p",[o._v("所以 cookie 和 session，你可以认为是同一层次的概念，也可以认为是不同层次的概念。具体到实现，session 因为 "),v("code",[o._v("session id")]),o._v(" 的存在，通常要借助 cookie 实现，但这并非必要，只能说是通用性较好的一种实现方案。")]),o._v(" "),v("h3",{attrs:{id:"_1-1-cookie"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-cookie"}},[o._v("#")]),o._v(" 1.1. cookie")]),o._v(" "),v("p",[o._v("服务器通过设置"),v("code",[o._v("set-cookie")]),o._v("这个响应头，将 cookie 信息返回给浏览器，浏览器将响应头中的 cookie 信息保存在本地。")]),o._v(" "),v("p",[o._v("当下次向服务器发送 HTTP 请求时，浏览器会自动将保存的这些 cookie 信息添加到请求头中。")]),o._v(" "),v("p",[v("code",[o._v("set-cookie")]),o._v("格式如下，")]),o._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[o._v("set-cookie: value[; expires=date][; domain=domain][; path=path][; secure]\n")])])]),v("p",[o._v("通过 cookie，服务器就会识别出浏览器，从而保证返回的数据是这个用户的。\n重点：")]),o._v(" "),v("ul",[v("li",[o._v("通过"),v("code",[o._v("set-cookie")]),o._v("设置")]),o._v(" "),v("li",[o._v("下次请求会自动带上")]),o._v(" "),v("li",[o._v("键值对，可设置多个")])]),o._v(" "),v("p",[v("img",{attrs:{src:_(435),alt:"set cookie"}})]),o._v(" "),v("h4",{attrs:{id:"_1-1-1-cookie属性"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-1-cookie属性"}},[o._v("#")]),o._v(" 1.1.1. "),v("code",[o._v("cookie")]),o._v("属性")]),o._v(" "),v("ul",[v("li",[o._v("max-age\n"),v("ul",[v("li",[o._v("过期时间有多长")]),o._v(" "),v("li",[o._v("默认在浏览器关闭时失效")])])]),o._v(" "),v("li",[o._v("expires\n"),v("ul",[v("li",[o._v("到哪个时间点过期")])])]),o._v(" "),v("li",[o._v("secure\n"),v("ul",[v("li",[o._v("表示这个 cookie 只会在 https 的时候才会发送")])])]),o._v(" "),v("li",[o._v("HttpOnly\n"),v("ul",[v("li",[o._v("设置后无法通过在 js 中使用 document.cookie 访问")]),o._v(" "),v("li",[o._v("保障安全，防止攻击者盗用用户 cookie")])])]),o._v(" "),v("li",[o._v("domain\n"),v("ul",[v("li",[o._v("表示该 cookie 对于哪个域是有效的。")])])])]),o._v(" "),v("h3",{attrs:{id:"_1-2-session"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-session"}},[o._v("#")]),o._v(" 1.2. session")]),o._v(" "),v("ul",[v("li",[o._v("存放在服务器的一种用来存放用户数据的类似 "),v("code",[o._v("HashTable")]),o._v(" 的结构")]),o._v(" "),v("li",[o._v("浏览器第一次发送请求时，服务器自动生成了 "),v("code",[o._v("HashTable")]),o._v(" 和 "),v("code",[o._v("SessionID")]),o._v(" 来唯一标识这个 "),v("code",[o._v("hash")]),o._v(" 表，并将 "),v("code",[o._v("sessionID")]),o._v(" 存放在 cookie 中通过响应发送到浏览器。")]),o._v(" "),v("li",[o._v("浏览器第二次发送请求会将前一次服务器响应中的 "),v("code",[o._v("sessionID")]),o._v(" 随着 "),v("code",[o._v("cookie")]),o._v(" 发送到服务器上，服务器从请求中提取 "),v("code",[o._v("sessionID")]),o._v("，并和保存的所有 "),v("code",[o._v("sessionID")]),o._v(" 进行对比，找到这个用户对应的 "),v("code",[o._v("hash")]),o._v(" 表。")]),o._v(" "),v("li",[o._v("一般这个值是有时间限制的，超时后销毁，默认 "),v("code",[o._v("30min")])]),o._v(" "),v("li",[o._v("当用户在应用程序的 "),v("code",[o._v("web")]),o._v(" 页面间挑转时，存储在 session 对象中的变量不会丢失而是在整个用户会话中一直存在下去。")]),o._v(" "),v("li",[v("code",[o._v("session")]),o._v(" 依赖于 "),v("code",[o._v("cookie")]),o._v("，因为 "),v("code",[o._v("sessionID")]),o._v(" 是存放在 "),v("code",[o._v("cookie")]),o._v(" 中的。")]),o._v(" "),v("li",[o._v("如果浏览器禁用了 "),v("code",[o._v("cookie")]),o._v(" ，同时 "),v("code",[o._v("session")]),o._v(" 也会失效（但是可以通过其它方式实现，比如在 "),v("code",[o._v("url")]),o._v(" 中传递 "),v("code",[o._v("sessionID")]),o._v("）")])]),o._v(" "),v("h4",{attrs:{id:"_1-2-1-sesssion-与-cookie-的区别"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-sesssion-与-cookie-的区别"}},[o._v("#")]),o._v(" 1.2.1. sesssion 与 cookie 的区别")]),o._v(" "),v("ul",[v("li",[o._v("cookie 存在客户端，session 存在于服务端。")]),o._v(" "),v("li",[o._v("cookie 在客户端中存放，容易伪造，不如 session 安全")]),o._v(" "),v("li",[o._v("session 会消耗大量服务器资源，cookie 在每次 HTTP 请求中都会带上，影响网络性能")])]),o._v(" "),v("h3",{attrs:{id:"_1-3-session和token"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-session和token"}},[o._v("#")]),o._v(" 1.3. "),v("code",[o._v("session")]),o._v("和"),v("code",[o._v("token")])]),o._v(" "),v("ol",[v("li",[v("p",[v("code",[o._v("session")]),o._v("是"),v("strong",[o._v("有状态")]),o._v("的，一般存于服务器内存或硬盘中，当服务器采用"),v("strong",[o._v("分布式或集群")]),o._v("时，"),v("code",[o._v("session")]),o._v("就会面对"),v("strong",[o._v("负载均衡")]),o._v("问题。")])]),o._v(" "),v("li",[v("p",[v("code",[o._v("token")]),o._v("是"),v("strong",[o._v("无状态")]),o._v("的，"),v("code",[o._v("token")]),o._v("字符串里就"),v("strong",[o._v("保存了所有的用户信息")]),o._v("。")])])]),o._v(" "),v("h4",{attrs:{id:"_1-3-1-token过程"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-1-token过程"}},[o._v("#")]),o._v(" 1.3.1. "),v("code",[o._v("token")]),o._v("过程")]),o._v(" "),v("ul",[v("li",[o._v("客户端登陆传递信息给服务端，服务端收到后把用户信息加密（"),v("code",[o._v("token")]),o._v("）传给客户端，客户端将"),v("code",[o._v("token")]),o._v("存放于"),v("code",[o._v("localStroage")]),o._v("等容器中。")]),o._v(" "),v("li",[o._v("客户端每次访问都传递token，服务端解密"),v("code",[o._v("token")]),o._v("，就知道这个用户是谁了。")]),o._v(" "),v("li",[o._v("通过cpu加解密，服务端就不需要存储"),v("code",[o._v("session")]),o._v("占用存储空间，就很好的解决负载均衡多服务器的问题了。")]),o._v(" "),v("li",[o._v("这个方法叫做"),v("code",[o._v("JWT(Json Web Token)")])])]),o._v(" "),v("h4",{attrs:{id:"_1-3-2-session和token的区别"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-2-session和token的区别"}},[o._v("#")]),o._v(" 1.3.2. "),v("code",[o._v("session")]),o._v("和"),v("code",[o._v("token")]),o._v("的区别")]),o._v(" "),v("ol",[v("li",[v("code",[o._v("session")]),o._v("存储于服务器，可以理解为一个状态列表，拥有一个唯一识别符号"),v("code",[o._v("sessionId")]),o._v("，通常存放于"),v("code",[o._v("cookie")]),o._v("中。服务器收到"),v("code",[o._v("cookie")]),o._v("后解析出"),v("code",[o._v("sessionId")]),o._v("，再去"),v("code",[o._v("session")]),o._v("列表中查找，才能找到相应"),v("code",[o._v("session")]),o._v("。依赖"),v("code",[o._v("cookie")]),o._v("。")]),o._v(" "),v("li",[v("code",[o._v("cookie")]),o._v("类似一个令牌，装有"),v("code",[o._v("sessionId")]),o._v("，存储在客户端，浏览器通常会自动添加。")]),o._v(" "),v("li",[v("code",[o._v("token")]),o._v("也类似一个令牌，无状态，用户信息都被加密到"),v("code",[o._v("token")]),o._v("中，服务器收到"),v("code",[o._v("token")]),o._v("后解密就可知道是哪个用户。需要开发者手动添加。")]),o._v(" "),v("li",[v("code",[o._v("jwt")]),o._v("只是一个"),v("strong",[o._v("跨域认证")]),o._v("的方案")])]),o._v(" "),v("h4",{attrs:{id:"_1-3-3-token可以抵抗csrf-cookie-session不行"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-3-token可以抵抗csrf-cookie-session不行"}},[o._v("#")]),o._v(" 1.3.3. "),v("code",[o._v("token")]),o._v("可以抵抗CSRF，"),v("code",[o._v("cookie+session")]),o._v("不行")]),o._v(" "),v("ul",[v("li",[o._v("在post请求的瞬间，"),v("code",[o._v("cookie")]),o._v("会"),v("strong",[o._v("被浏览器自动添加到请求头")]),o._v("中。")]),o._v(" "),v("li",[o._v("但"),v("code",[o._v("token")]),o._v("不同，"),v("code",[o._v("token")]),o._v("是开发者为了防范csrf而特别设计的令牌，"),v("strong",[o._v("浏览器不会自动添加到"),v("code",[o._v("headers")]),o._v("里")]),o._v("，"),v("strong",[o._v("攻击者也无法访问用户的"),v("code",[o._v("token")])]),o._v("，所以提交的表单无法通过服务器过滤，也就无法形成攻击。")])]),o._v(" "),v("p",[o._v("参考资料：")]),o._v(" "),v("ol",[v("li",[v("a",{attrs:{href:"https://github.com/huyaocode/webKnowledge/blob/master/%E7%BD%91%E7%BB%9C/cookie%E5%92%8Csession.md",target:"_blank",rel:"noopener noreferrer"}},[o._v("cookie 和 session"),v("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=s.exports}}]);