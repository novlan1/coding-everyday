(window.webpackJsonp=window.webpackJsonp||[]).push([[96],{398:function(e,t,a){"use strict";a.r(t);var s=a(25),o=Object(s.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("ul",[t("li",[t("a",{attrs:{href:"#1-cookie-%E7%9A%84-samesite-%E5%B1%9E%E6%80%A7"}},[e._v("1. Cookie 的 SameSite 属性")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"#11-%E4%B8%80csrf-%E6%94%BB%E5%87%BB%E6%98%AF%E4%BB%80%E4%B9%88"}},[e._v("1.1. 一、CSRF 攻击是什么？")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#12-%E4%BA%8Csamesite-%E5%B1%9E%E6%80%A7"}},[e._v("1.2. 二、SameSite 属性")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"#121-21-strict"}},[e._v("1.2.1. 2.1 Strict")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#122-22-lax"}},[e._v("1.2.2. 2.2 Lax")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#123-23-none"}},[e._v("1.2.3. 2.3 None")])])])])])])]),e._v(" "),t("h2",{attrs:{id:"_1-cookie-的-samesite-属性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-cookie-的-samesite-属性"}},[e._v("#")]),e._v(" 1. Cookie 的 SameSite 属性")]),e._v(" "),t("p",[e._v("Chrome 51 开始，浏览器的 Cookie 新增加了一个SameSite属性，用来防止 CSRF 攻击和用户追踪。")]),e._v(" "),t("h3",{attrs:{id:"_1-1-一、csrf-攻击是什么"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-一、csrf-攻击是什么"}},[e._v("#")]),e._v(" 1.1. 一、CSRF 攻击是什么？")]),e._v(" "),t("p",[e._v("Cookie 往往用来存储用户的身份信息，"),t("strong",[e._v("恶意网站可以设法伪造带有正确 Cookie 的 HTTP 请求，这就是 CSRF 攻击。")])]),e._v(" "),t("p",[e._v("举例来说，用户登陆了银行网站"),t("code",[e._v("your-bank.com")]),e._v("，银行服务器发来了一个 Cookie。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Set-Cookie:id=a3fWa;\n")])])]),t("p",[e._v("用户后来又访问了恶意网站"),t("code",[e._v("malicious.com")]),e._v("，上面有一个表单。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('<form action="your-bank.com/transfer" method="POST">\n  ...\n</form>\n')])])]),t("p",[e._v("用户一旦被诱骗发送这个表单，"),t("strong",[e._v("银行网站就会收到带有正确 Cookie 的请求")]),e._v("。为了防止这种攻击，表单一般都带有一个"),t("strong",[e._v("随机 token")]),e._v("，告诉服务器这是真实请求。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('<form action="your-bank.com/transfer" method="POST">\n  <input type="hidden" name="token" value="dad3weg34">\n  ...\n</form>\n')])])]),t("p",[t("strong",[e._v("这种第三方网站引导发出的 Cookie，就称为第三方 Cookie。它除了用于 CSRF 攻击，还可以用于用户追踪。")])]),e._v(" "),t("p",[e._v("比如，Facebook 在第三方网站插入一张看不见的图片。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('<img src="facebook.com" style="visibility:hidden;">\n')])])]),t("p",[e._v("浏览器加载上面代码时，"),t("strong",[e._v("就会向 Facebook 发出带有 Cookie 的请求，从而 Facebook 就会知道你是谁，访问了什么网站。")])]),e._v(" "),t("h3",{attrs:{id:"_1-2-二、samesite-属性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-二、samesite-属性"}},[e._v("#")]),e._v(" 1.2. 二、SameSite 属性")]),e._v(" "),t("p",[t("strong",[e._v("Cookie 的SameSite属性用来限制第三方 Cookie")]),e._v("，从而减少安全风险。")]),e._v(" "),t("p",[e._v("它可以设置三个值。")]),e._v(" "),t("ul",[t("li",[e._v("Strict")]),e._v(" "),t("li",[e._v("Lax")]),e._v(" "),t("li",[e._v("None")])]),e._v(" "),t("h4",{attrs:{id:"_1-2-1-2-1-strict"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-2-1-strict"}},[e._v("#")]),e._v(" 1.2.1. 2.1 Strict")]),e._v(" "),t("p",[e._v("Strict最为严格，完全禁止第三方 Cookie，"),t("strong",[e._v("跨站点时，任何情况下都不会发送 Cookie")]),e._v("。换言之，只有当前网页的 URL 与请求目标一致，才会带上 Cookie。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Set-Cookie: CookieName=CookieValue; SameSite=Strict;\n")])])]),t("p",[e._v("这个规则过于严格，可能造成非常不好的用户体验。比如，"),t("strong",[e._v("当前网页有一个 GitHub 链接，用户点击跳转就不会带有 GitHub 的 Cookie，跳转过去总是未登陆状态")]),e._v("。")]),e._v(" "),t("h4",{attrs:{id:"_1-2-2-2-2-lax"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-2-2-2-lax"}},[e._v("#")]),e._v(" 1.2.2. 2.2 Lax")]),e._v(" "),t("p",[e._v("Lax规则稍稍放宽，"),t("strong",[e._v("大多数情况也是不发送第三方 Cookie，但是导航到目标网址的 Get 请求除外。")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Set-Cookie: CookieName=CookieValue; SameSite=Lax;\n")])])]),t("p",[t("strong",[e._v("导航到目标网址的 GET 请求，只包括三种情况：链接，预加载请求，GET 表单")]),e._v("。详见下表。")]),e._v(" "),t("p",[t("img",{attrs:{src:"http://img.uwayfly.com/article_mike_20200707131329_62bdb65f83e2.png",alt:"img"}})]),e._v(" "),t("p",[e._v("设置了Strict或Lax以后，基本就杜绝了 CSRF 攻击。当然，前提是用户浏览器支持 SameSite 属性。")]),e._v(" "),t("h4",{attrs:{id:"_1-2-3-2-3-none"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-3-2-3-none"}},[e._v("#")]),e._v(" 1.2.3. 2.3 None")]),e._v(" "),t("p",[t("strong",[e._v("Chrome 计划将Lax变为默认设置")]),e._v("。这时，网站可以选择显式关闭SameSite属性，将其设为None。不过，"),t("strong",[e._v("前提是必须同时设置Secure属性（Cookie 只能通过 HTTPS 协议发送），否则无效。")])]),e._v(" "),t("p",[e._v("下面的设置无效。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Set-Cookie: widget_session=abc123; SameSite=None\n")])])]),t("p",[e._v("下面的设置有效。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Set-Cookie: widget_session=abc123; SameSite=None; Secure\n")])])])])}),[],!1,null,null,null);t.default=o.exports}}]);