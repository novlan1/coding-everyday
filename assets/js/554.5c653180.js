(window.webpackJsonp=window.webpackJsonp||[]).push([[554],{825:function(t,s,a){"use strict";a.r(s);var e=a(14),r=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("[toc]")]),t._v(" "),s("h2",{attrs:{id:"_1-开始"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-开始"}},[t._v("#")]),t._v(" 1. 开始")]),t._v(" "),s("p",[t._v("有个项目需要用到IM聊天功能，在向上翻更多聊天记录时，需要将位置固定，也就是加载更多时不要滚动到顶部，也不要跳动、抖动。")]),t._v(" "),s("p",[t._v("尝试了n种方法，终于可以了，这里记录下。")]),t._v(" "),s("h2",{attrs:{id:"_2-尝试方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-尝试方案"}},[t._v("#")]),t._v(" 2. 尝试方案")]),t._v(" "),s("h3",{attrs:{id:"_2-1-overflow-anchor"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-overflow-anchor"}},[t._v("#")]),t._v(" 2.1. "),s("code",[t._v("overflow-anchor")])]),t._v(" "),s("p",[t._v("尝试用"),s("code",[t._v("css")]),t._v("自带属性"),s("code",[t._v("overflow-anchor: auto")]),t._v("解决这一问题，但是它的兼容性太差了，在"),s("code",[t._v("chrome")]),t._v("、开发者工具中调试的效果可以，但是真机小程序、H5都不行。")]),t._v(" "),s("p",[t._v("此外，这一属性需要"),s("code",[t._v("scrollTop")]),t._v("不能为"),s("code",[t._v("0")]),t._v("，也就是在插入数据之前检查下"),s("code",[t._v("scrollTop")]),t._v("，如果为"),s("code",[t._v("0")]),t._v("，则调用API让"),s("code",[t._v("scroll-view")]),t._v("向下滚动一点。")]),t._v(" "),s("h3",{attrs:{id:"_2-2-赋值前将scrolly设置为false"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-赋值前将scrolly设置为false"}},[t._v("#")]),t._v(" 2.2. 赋值前将"),s("code",[t._v("scrollY")]),t._v("设置为"),s("code",[t._v("false")])]),t._v(" "),s("p",[t._v("这种方式是想在"),s("code",[t._v("list")]),t._v("添加前将"),s("code",[t._v("scroll-view")]),t._v("固定，然后在前面插入数据，想法是挺好的，但是一插入数据，"),s("code",[t._v("scroll-view")]),t._v("还是滚动到了顶部，也就是"),s("code",[t._v("scroll-view")]),t._v("内部是让"),s("code",[t._v("scroll-top")]),t._v("在插入数据前后不变。")]),t._v(" "),s("h3",{attrs:{id:"_2-3-赋值后立即设置scrolltop"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-赋值后立即设置scrolltop"}},[t._v("#")]),t._v(" 2.3. 赋值后立即设置"),s("code",[t._v("scrollTop")])]),t._v(" "),s("p",[t._v("这种方式是想在数据插入后立即滚动到原来的位置，H5是没问题的，小程序不可以，因为小程序设置"),s("code",[t._v("scrollTop")]),t._v("是异步的，"),s("code",[t._v("list")]),t._v("一旦赋值，并传递到渲染层就渲染了，这时候再改变"),s("code",[t._v("scrollTop")]),t._v("，或设置"),s("code",[t._v("scrollInfoView")]),t._v("会导致页面抖动。")]),t._v(" "),s("h3",{attrs:{id:"_2-4-赋值后立即调用scrollinfoview"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-赋值后立即调用scrollinfoview"}},[t._v("#")]),t._v(" 2.4. 赋值后立即调用"),s("code",[t._v("scrollInfoView")])]),t._v(" "),s("p",[t._v("无效的原因与上相同。")]),t._v(" "),s("h2",{attrs:{id:"_3-解决方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-解决方法"}},[t._v("#")]),t._v(" 3. 解决方法")]),t._v(" "),s("h3",{attrs:{id:"_3-1-scroll-view倒置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-scroll-view倒置"}},[t._v("#")]),t._v(" 3.1. "),s("code",[t._v("scroll-view")]),t._v("倒置")]),t._v(" "),s("p",[t._v("采用的是"),s("code",[t._v("scroll-view")]),t._v("倒置，列表数据也倒置，这样每次加载下一页，可以当成是普通"),s("code",[t._v("list")]),t._v("的"),s("code",[t._v("loadMore")]),t._v("，从而解决跳动的问题。")]),t._v(" "),s("div",{staticClass:"language-scss extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scss"}},[s("code",[s("span",{pre:!0,attrs:{class:"token selector"}},[t._v(".press-message-detail ")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("transform")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rotate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("180deg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v(".press-message-item ")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("transform")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rotate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("180deg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("调用者无需关心"),s("code",[t._v("list")]),t._v("的翻转，由组件内部处理：")]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  computed"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("reversedList")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" res "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("reverse")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"_3-2-隐藏scrollbar"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-隐藏scrollbar"}},[t._v("#")]),t._v(" 3.2. 隐藏"),s("code",[t._v("scrollbar")])]),t._v(" "),s("p",[t._v("同时要注意隐藏"),s("code",[t._v("scrollbar")]),t._v("，因为"),s("code",[t._v("scrollbar")]),t._v("此时跑到了左边。用下面的方式在小程序中无效，采用的是Dom覆盖的方式。")]),t._v(" "),s("div",{staticClass:"language-scss extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scss"}},[s("code",[s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("::-webkit-scrollbar ")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("display")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" none"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("width")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("height")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("color")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" transparent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"_3-3-数据少的情况"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-数据少的情况"}},[t._v("#")]),t._v(" 3.3. 数据少的情况")]),t._v(" "),s("p",[t._v("此外，当聊天内容不足一屏时，消息是堆在下面的，因为"),s("code",[t._v("scroll-view")]),t._v("被倒置了。")]),t._v(" "),s("p",[t._v("解决方案是，设置一个"),s("code",[t._v("placeholder")]),t._v("的"),s("code",[t._v("dom")]),t._v("，设置为"),s("code",[t._v("flex:1")]),t._v("，让它和消息内容共享父容器的高度。")]),t._v(" "),s("h2",{attrs:{id:"_4-体验地址"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-体验地址"}},[t._v("#")]),t._v(" 4. 体验地址")]),t._v(" "),s("p",[t._v("目前在"),s("a",{attrs:{href:"https://novlan1.github.io/press-ui/components/press/press-message-detail.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("press-ui"),s("OutboundLink")],1),t._v("示例项目中可以"),s("a",{attrs:{href:"https://novlan1.github.io/press-ui-demo/#/pages/press/message-detail/message-detail?v=1687599337822&lang=zh-CN",target:"_blank",rel:"noopener noreferrer"}},[t._v("查看效果"),s("OutboundLink")],1),t._v("，三端（H5、微信小程序、QQ小程序）表现一致。")]),t._v(" "),s("p",[t._v("另外，欢迎使用"),s("code",[t._v("press-ui")]),t._v("跨端组件库。")]),t._v(" "),s("img",{attrs:{src:"https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2023/6/im-anchor.gif",width:"350"}}),t._v(" "),s("h2",{attrs:{id:"_5-资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-资料"}},[t._v("#")]),t._v(" 5. 资料")]),t._v(" "),s("p",[t._v("网上被这一问题困扰的人还挺多的，这是我查阅资料时看到的一部分：")]),t._v(" "),s("ol",[s("li",[t._v("https://developers.weixin.qq.com/community/develop/doc/0008e80a748c98a7dc49645fa51800")]),t._v(" "),s("li",[t._v("https://developers.weixin.qq.com/community/develop/doc/0006aa1bedcb18b6a148381db5b800")]),t._v(" "),s("li",[t._v("https://developers.weixin.qq.com/community/develop/doc/0002eaf87a0ac04bfeb9eebca51400")]),t._v(" "),s("li",[t._v("https://developers.weixin.qq.com/community/develop/doc/000e4e0bc606f0c0f7568723051c00")]),t._v(" "),s("li",[t._v("https://developers.weixin.qq.com/community/develop/doc/000ae43bd30e088b2adc6dc2d51c00")]),t._v(" "),s("li",[t._v("https://developers.weixin.qq.com/community/develop/doc/000e62f2ad48a09ed8ea57e185b000")])])])}),[],!1,null,null,null);s.default=r.exports}}]);