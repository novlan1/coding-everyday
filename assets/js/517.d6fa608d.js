(window.webpackJsonp=window.webpackJsonp||[]).push([[517],{820:function(e,o,v){"use strict";v.r(o);var _=v(25),t=Object(_.a)({},(function(){var e=this,o=e._self._c;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("p",[o("code",[e._v("startApp")]),e._v(" 流程")]),e._v(" "),o("p",[e._v("H5 部分")]),e._v(" "),o("ol",[o("li",[o("code",[e._v("recordHistory")]),e._v("，"),o("code",[e._v("router.beforeEach")]),e._v(" 钩子函数中设置 "),o("code",[e._v("history")]),e._v(" 本地存储，维护历史记录栈")]),e._v(" "),o("li",[o("code",[e._v("beforeEachFn")]),e._v("，"),o("code",[e._v("router.afterEach")]),e._v(" 钩子\n"),o("ul",[o("li",[e._v("营地设置右上角分享")]),e._v(" "),o("li",[e._v("判断是否非延迟状态，并加载 "),o("code",[e._v("vConsole")])])])]),e._v(" "),o("li",[o("code",[e._v("afterEachFn")]),e._v("，"),o("code",[e._v("router.afterEach")]),e._v(" 钩子\n"),o("ul",[o("li",[e._v("加载 "),o("code",[e._v("vConsole")])]),e._v(" "),o("li",[o("code",[e._v("checkLogin")]),e._v("，检查登录状态")]),e._v(" "),o("li",[o("code",[e._v("reportAegisEvent")]),e._v("，上报当前页面路由")]),e._v(" "),o("li",[e._v("修复 QQ 下的复制链接")])])]),e._v(" "),o("li",[e._v("initReportTK，存储 "),o("code",[e._v("reporttk")])])]),e._v(" "),o("p",[e._v("通用部分")]),e._v(" "),o("ol",[o("li",[o("code",[e._v("initMixin")]),e._v("包括默认的 "),o("code",[e._v("projectMixins")]),e._v("，以及传入的 "),o("code",[e._v("options.projectMixins")]),e._v(" "),o("ul",[o("li",[e._v("默认的有 commonMixin, tcssReportMixin, lifecycleMixin 等")])])]),e._v(" "),o("li",[o("code",[e._v("initNetwork")]),e._v("，初始化网络框架")]),e._v(" "),o("li",[o("code",[e._v("initConfig")]),e._v("，设置以下内容\n"),o("ul",[o("li",[o("code",[e._v("app.config.devtools")])]),e._v(" "),o("li",[o("code",[e._v("app.config.productionTip")])]),e._v(" "),o("li",[o("code",[e._v("app.config.errorHandler")])]),e._v(" "),o("li",[o("code",[e._v("app.config.ignoredElements")])])])]),e._v(" "),o("li",[o("code",[e._v("initPlugin")]),e._v("，包括\n"),o("ul",[o("li",[o("code",[e._v("VueLazyLoad")]),e._v("，H5 独有，指令")]),e._v(" "),o("li",[o("code",[e._v("ebusV2")])]),e._v(" "),o("li",[o("code",[e._v("treport")]),e._v("，H5 独有，指令")])])]),e._v(" "),o("li",[o("code",[e._v("initReport")]),e._v("，包括\n"),o("ul",[o("li",[o("code",[e._v("initReportAegis")])]),e._v(" "),o("li",[o("code",[e._v("initPromiseCatchErrorReport")]),e._v("，监听 "),o("code",[e._v("promise error")])])])]),e._v(" "),o("li",[o("code",[e._v("initRouter")]),e._v("，使用 "),o("code",[e._v("Vue.use(Router)")]),e._v("，或者 "),o("code",[e._v("SimpleVueRouter")])]),e._v(" "),o("li",[o("code",[e._v("initStore")]),e._v("，使用 "),o("code",[e._v("new Vuex.Store")])]),e._v(" "),o("li",[o("code",[e._v("initApp")]),e._v("，使用 "),o("code",[e._v("new Vue({ el: '#app' })")]),e._v("，注册 "),o("code",[e._v("window.app = app")])]),e._v(" "),o("li",[o("code",[e._v("initGlobalAppData")]),e._v("，设置一些全局变量，比如 "),o("code",[e._v("window.app.firstChannel")])]),e._v(" "),o("li",[o("code",[e._v("initXss")]),e._v("，注册 "),o("code",[e._v("Vue.prototype.xss")])]),e._v(" "),o("li",[o("code",[e._v("pmdInitConfig")]),e._v("，注册传入的 "),o("code",[e._v("config")])])]),e._v(" "),o("p",[e._v("改动或优化点：")]),e._v(" "),o("p",[o("code",[e._v("initRouter")]),e._v(" 中，"),o("code",[e._v("SimpleVueRouter(options)")]),e._v(" 方法中, "),o("code",[e._v("getRoutes")]),e._v(" 会不再使用 "),o("code",[e._v("ROUTES")]),e._v("，而是先尝试使用设置的，然后使用 "),o("code",[e._v("ROUTES")]),e._v("，也就是如果传入了 "),o("code",[e._v("routerMap")]),e._v("，就会用 "),o("code",[e._v("routerMap")]),e._v("。")]),e._v(" "),o("p",[e._v("另外，"),o("code",[e._v("initRouter")]),e._v(" 大致逻辑如下，如果是小程序，或者设置了 "),o("code",[e._v("options.SimpleVueRouter")]),e._v(" 为 "),o("code",[e._v("true")]),e._v("，则使用 "),o("code",[e._v("uni-simple-router")]),e._v("，否则使用 "),o("code",[e._v("vue-router")]),e._v("。如果你是非 uni-app 项目的话，则要使用 "),o("code",[e._v("vue-router")]),e._v("，就必须传入 "),o("code",[e._v("routerMap")]),e._v(" 了。")]),e._v(" "),o("p",[e._v("加了 "),o("code",[e._v("routerInterCeptor")]),e._v(" 方法的执行，跳转的时候 H5 加了 "),o("code",[e._v("type")]),e._v("，小程序的时候 "),o("code",[e._v("params、query")]),e._v(" 混合。")]),e._v(" "),o("div",{staticClass:"language-ts extra-class"},[o("pre",{pre:!0,attrs:{class:"language-ts"}},[o("code",[o("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("options"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("SimpleVueRouter "),o("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&&")]),e._v(" app"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("$router"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),o("span",{pre:!0,attrs:{class:"token function"}},[e._v("routerInterCeptor")]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("app"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("$router"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])])])}),[],!1,null,null,null);o.default=t.exports}}]);