(window.webpackJsonp=window.webpackJsonp||[]).push([[226],{499:function(a,t,s){"use strict";s.r(t);var e=s(14),n=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("ul",[t("li",[t("a",{attrs:{href:"#1-nginx"}},[a._v("1. Nginx")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"#11-%E6%97%A5%E5%BF%97%E5%8F%98%E9%87%8F"}},[a._v("1.1. 日志变量")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#12-%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"}},[a._v("1.2. 全局变量")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#13-%E4%BA%8B%E4%BB%B6%E9%85%8D%E7%BD%AEevents"}},[a._v("1.3. 事件配置events")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#14-proxy_buffering"}},[a._v("1.4. "),t("code",[a._v("proxy_buffering")])])]),a._v(" "),t("li",[t("a",{attrs:{href:"#15-nginx-%E4%BB%A3%E7%90%86"}},[a._v("1.5. Nginx 代理")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#16-%E9%85%8D%E7%BD%AEhttps%E4%BB%A5%E5%8F%8Ahttp%E8%87%AA%E5%8A%A8%E8%B7%B3%E8%BD%AC%E5%88%B0https"}},[a._v("1.6. 配置"),t("code",[a._v("https")]),a._v("以及"),t("code",[a._v("http")]),a._v("自动跳转到"),t("code",[a._v("https")])]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"#161-%E5%B8%B8%E8%A7%81%E8%A7%84%E5%88%99"}},[a._v("1.6.1. 常见规则")])])])])])])]),a._v(" "),t("h2",{attrs:{id:"_1-nginx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-nginx"}},[a._v("#")]),a._v(" 1. Nginx")]),a._v(" "),t("h3",{attrs:{id:"_1-1-日志变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-日志变量"}},[a._v("#")]),a._v(" 1.1. 日志变量")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$remote_addr")]),a._v(" 与 "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$http_x_forwarded_for")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 用以记录客户端的ip地址； ")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$remote_user")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 用来记录客户端用户名称； ")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$time_local")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 用来记录访问时间与时区；")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$request")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 用来记录请求的url与http协议；")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$status")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 用来记录请求状态；成功是200， ")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$body_bytes_sent")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 记录发送给客户端文件主体内容大小；")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$http_referer")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 用来记录从那个页面链接访问过来的； ")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$http_user_agent")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 记录客户端浏览器的相关信息；")]),a._v("\n")])])]),t("h3",{attrs:{id:"_1-2-全局变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-全局变量"}},[a._v("#")]),a._v(" 1.2. 全局变量")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("worker_processes auto"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# nginx开启的进程数")]),a._v("\n\npid /run/nginx.pid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 指定进程ID存储文件位置")]),a._v("\n")])])]),t("h3",{attrs:{id:"_1-3-事件配置events"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-事件配置events"}},[a._v("#")]),a._v(" 1.3. 事件配置events")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("use [ kqueue | rtsig | epoll | /dev/poll | select | poll ];\n")])])]),t("p",[t("code",[a._v("epoll")]),a._v("模型是"),t("code",[a._v("Linux 2.6")]),a._v("以上版本内核中的高性能网络"),t("code",[a._v("I/O")]),a._v("模型，如果跑在"),t("code",[a._v("FreeBSD")]),a._v("上面，就用"),t("code",[a._v("kqueue")]),a._v("模型。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("use epoll"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\nworker_connections "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#最大连接数，默认为512")]),a._v("\n")])])]),t("ul",[t("li",[a._v("开启高效传输模式。")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("sendfile on"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("ul",[t("li",[a._v("防止网络阻塞")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("tcp_nopush on"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\ntcp_nodelay on"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" \n")])])]),t("ul",[t("li",[a._v("客户端连接超时时间，单位是秒")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("keepalive_timeout "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("60")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("ul",[t("li",[a._v("客户端请求头读取超时时间")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("client_header_timeout "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("ul",[t("li",[a._v("设置客户端请求主体读取超时时间")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("client_body_timeout "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("ul",[t("li",[a._v("响应客户端超时时间")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("send_timeout "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("h3",{attrs:{id:"_1-4-proxy-buffering"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-proxy-buffering"}},[a._v("#")]),a._v(" 1.4. "),t("code",[a._v("proxy_buffering")])]),a._v(" "),t("p",[t("code",[a._v("proxy_buffering")]),a._v("主要是实现被代理服务器的数据和客户端的请求异步。")]),a._v(" "),t("p",[a._v("为了方便理解，我们定义三个角色，A为客户端，B为代理服务器，C为被代理服务器。")]),a._v(" "),t("ul",[t("li",[a._v("当"),t("code",[a._v("proxy_buffering")]),a._v("开启，A发起请求到B，B再到C，C反馈的数据先到B的"),t("code",[a._v("buffer")]),a._v("上，然后B会根据"),t("code",[a._v("proxy_busy_buffer_size")]),a._v("来决定什么时候开始把数据传输给A。")]),a._v(" "),t("li",[a._v("在此过程中，如果所有的"),t("code",[a._v("buffer")]),a._v("被写满，数据将会写入到"),t("code",[a._v("temp_file")]),a._v("中。")]),a._v(" "),t("li",[a._v("相反，如果"),t("code",[a._v("proxy_buffering")]),a._v("关闭，C反馈的数据实时地通过B传输给A。")])]),a._v(" "),t("h3",{attrs:{id:"_1-5-nginx-代理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-nginx-代理"}},[a._v("#")]),a._v(" 1.5. Nginx 代理")]),a._v(" "),t("ul",[t("li",[t("code",[a._v("node")]),a._v("和"),t("code",[a._v("nginx")]),a._v("配置的时候，不能在根目录"),t("code",[a._v("/")]),a._v("下配置代理，那是"),t("code",[a._v("react")]),a._v("或者"),t("code",[a._v("vue")]),a._v("放的真实的地址。")]),a._v(" "),t("li",[a._v("而应该再添加一个"),t("code",[a._v("location")]),a._v("，代理"),t("code",[a._v("/api")]),a._v("，这也是为什么很多项目代码里请求地址前面都是"),t("code",[a._v("/api")]),a._v("开头。")])]),a._v(" "),t("h3",{attrs:{id:"_1-6-配置https以及http自动跳转到https"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-配置https以及http自动跳转到https"}},[a._v("#")]),a._v(" 1.6. 配置"),t("code",[a._v("https")]),a._v("以及"),t("code",[a._v("http")]),a._v("自动跳转到"),t("code",[a._v("https")])]),a._v(" "),t("p",[t("img",{attrs:{src:"/imgs/nginx_https_config.png",alt:"https配置"}})]),a._v(" "),t("h4",{attrs:{id:"_1-6-1-常见规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-1-常见规则"}},[a._v("#")]),a._v(" 1.6.1. 常见规则")]),a._v(" "),t("ul",[t("li",[a._v("http：协议级别")]),a._v(" "),t("li",[a._v("server：服务器级别")]),a._v(" "),t("li",[a._v("location：请求级别")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("location [=|~|~*|^~] /uri/ { … }\n")])])]),t("p",[t("code",[a._v("=")]),a._v("表示：必须与指定的模式精确匹配")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("server {\nserver_name sish\n   location = /abc {\n   }\n}\n")])])]),t("p",[a._v("那么，如下是对的：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("`http://baidu.com/abc`\n`http://baidu.com/abc?p1`\n")])])]),t("p",[a._v("如下是错的：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("`http://baidu.com/abc/`\n`http://baidu.com/abcde`\n")])])]),t("p",[t("code",[a._v("~")]),a._v(" 表示：指定的正则表达式要区分大小写")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("server {\nserver_name baidu.com;\n   location ~ ^/abc$ {\n   }\n}\n")])])]),t("p",[a._v("那么，如下是对的：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("http://baidu.com/abc\nhttp://baidu.com/abc?p1=11&p2=22\n")])])]),t("p",[a._v("如下是错的：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("http://baidu.com/ABC\nhttp://baidu.com/abc/\nhttp://baidu.com/abcde\n")])])]),t("p",[t("code",[a._v("~*")]),a._v(" 表示：指定的正则表达式不区分大小写")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("server {\nserver_name baidu.com;\nlocation ~* ^/abc$ {\n   }\n}\n")])])]),t("p",[a._v("那么，如下是对的：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("http://baidu.com/abc\nhttp://baidu..com/ABC\nhttp://baidu..com/abc?p1=11&p2=22\n")])])]),t("p",[a._v("如下是错的：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("http://baidu..com/abc/\nhttp://baidu..com/abcde\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);