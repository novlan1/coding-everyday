(window.webpackJsonp=window.webpackJsonp||[]).push([[544],{817:function(t,s,a){"use strict";a.r(s);var n=a(14),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("[toc]")]),t._v(" "),s("h2",{attrs:{id:"_1-开始"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-开始"}},[t._v("#")]),t._v(" 1. 开始")]),t._v(" "),s("p",[t._v("持续记录项目重构过程中的方法、思路和感想。")]),t._v(" "),s("p",[t._v("首先，要有一个意识，不要指望需求一成不变，不要指望项目结构、代码一成不变，程序员20%的时间花在写代码上，80%的时间花在后续维护迭代上。")]),t._v(" "),s("p",[t._v("如何让代码更健壮，更能适应将来的变化呢？个人实践中觉得有用的包括：")]),t._v(" "),s("p",[t._v("理论层面：")]),t._v(" "),s("ul",[s("li",[t._v("抽象工具、组件，提高复用性")]),t._v(" "),s("li",[t._v("单一职责原则，保持简单，并减少耦合")]),t._v(" "),s("li",[t._v("保持单向依赖")])]),t._v(" "),s("p",[t._v("实现层面：")]),t._v(" "),s("ul",[s("li",[t._v("ts语法，编译阶段发现错误")]),t._v(" "),s("li",[t._v("函数式调用替换普通写法，减少中间变量")]),t._v(" "),s("li",[t._v("项目分层，不同功能模块放在不同的文件夹")])]),t._v(" "),s("p",[t._v("抽象能力是一种容易忽略的能力，每次遇到需求，容易无脑拷贝，其实可以看看和以前的组件、逻辑有什么异同，找找规则，封装、抽象出公共的、稳定的部分。")]),t._v(" "),s("p",[t._v("应该将复杂的事情简单做，化繁为简，而不是所谓的简单的事情复杂做。“化繁为简”这个词在招聘要求中看到过一次。")]),t._v(" "),s("h2",{attrs:{id:"_2-关于重构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-关于重构"}},[t._v("#")]),t._v(" 2. 关于重构")]),t._v(" "),s("h3",{attrs:{id:"_2-1-目的"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-目的"}},[t._v("#")]),t._v(" 2.1. 目的")]),t._v(" "),s("p",[t._v("为什么进行重构呢？原因各不相同：")]),t._v(" "),s("ul",[s("li",[t._v("生产力低下\n"),s("ul",[s("li",[t._v("框架原因，比如"),s("code",[t._v("jquery")]),t._v("这种操作"),s("code",[t._v("dom")]),t._v("的方式，比不上数据驱动开发效率高")]),t._v(" "),s("li",[t._v("代码自身问题，耦合严重，理解成本高、开发效率低")])])]),t._v(" "),s("li",[t._v("性能差")]),t._v(" "),s("li",[t._v("其他")])]),t._v(" "),s("h3",{attrs:{id:"_2-2-分级"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-分级"}},[t._v("#")]),t._v(" 2.2. 分级")]),t._v(" "),s("p",[t._v("从技术层面上，重构可以分为：")]),t._v(" "),s("ul",[s("li",[t._v("技术栈迁移，比如用"),s("code",[t._v("electron")]),t._v("跨平台框架重构多端代码，本质是重写，也可视为广义的重构")]),t._v(" "),s("li",[t._v("核心框架迁移，可复用一小部分逻辑，但核心代码仍需重写，比如"),s("code",[t._v("jquery")]),t._v("到"),s("code",[t._v("vue")]),t._v("、"),s("code",[t._v("vue")]),t._v("到"),s("code",[t._v("react")])]),t._v(" "),s("li",[t._v("核心框架升级，或架构模式变动，比如"),s("code",[t._v("vue2")]),t._v("到"),s("code",[t._v("vue3")]),t._v("、客户端渲染到"),s("code",[t._v("ssr")])]),t._v(" "),s("li",[t._v("其他框架迁移")]),t._v(" "),s("li",[t._v("代码细节改造")])]),t._v(" "),s("p",[t._v("从项目层面上，重构可以分为：")]),t._v(" "),s("ul",[s("li",[t._v("项目级别")]),t._v(" "),s("li",[t._v("多页面级别")]),t._v(" "),s("li",[t._v("单页面级别")]),t._v(" "),s("li",[t._v("组件级别")])]),t._v(" "),s("p",[t._v("除了项目级别的改动，也就是推倒重来、另起炉灶，其他的重构都建议在原地改。")]),t._v(" "),s("p",[t._v("比如要沉淀组件库，或ui和逻辑的分离，先在原来的地方改好、再迁移效率会更高，因为如果在组件库上改，需要mock很多环境，效率低。")]),t._v(" "),s("h2",{attrs:{id:"_3-原则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-原则"}},[t._v("#")]),t._v(" 3. 原则")]),t._v(" "),s("h3",{attrs:{id:"_3-1-单一职责"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-单一职责"}},[t._v("#")]),t._v(" 3.1. 单一职责")]),t._v(" "),s("p",[t._v("好代码一定是符合单一职责原则的，如果一个组件、函数、类不符合这个原则，短期内看似做的很快，长远来看，一定会后续迭代时频繁出bug、难维护，还会让其他开发者无法复用，导致频繁拷贝代码然后修改。")]),t._v(" "),s("p",[t._v("不符合单一职责原则的代码，模块化一定不会太好，可复用性低。")]),t._v(" "),s("p",[t._v("符合单一职责的代码，在需求变更、项目重构时可很容易的复用、迁移、扩展等，哪怕是技术栈的迁移，比如"),s("code",[t._v("jquery")]),t._v("到"),s("code",[t._v("vue")]),t._v("、"),s("code",[t._v("vue")]),t._v("到"),s("code",[t._v("react")]),t._v("这种，开发者都能轻易的理清之前的逻辑。")]),t._v(" "),s("h3",{attrs:{id:"_3-2-单向依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-单向依赖"}},[t._v("#")]),t._v(" 3.2. 单向依赖")]),t._v(" "),s("p",[t._v("单一职责可以降低模块内部的复杂度，单向依赖可以降低模块之间的复杂度，增强可维护性。")]),t._v(" "),s("p",[t._v("不要用"),s("code",[t._v("someMethod.call(this)")]),t._v("，这种本质上是违反了"),s("strong",[t._v("单向依赖")]),t._v("，本来是组件依赖工具方法，现在工具方法又依赖了组件内的内容。")]),t._v(" "),s("p",[t._v("也许一开始用到了一两个属性，但随着不断迭代，后面这个"),s("code",[t._v("this")]),t._v("会越用越多，后面就积重难返了。所以一开始就不要用 "),s("code",[t._v(".call(this)")]),t._v("这种语法。")]),t._v(" "),s("p",[t._v("另外，公共基础库中对业务项目的"),s("code",[t._v("config")]),t._v("的依赖，也是违反了单向依赖原则，这种情况其实一个依赖注入就解决了，就是在"),s("code",[t._v("startApp")]),t._v("的时候把"),s("code",[t._v("config")]),t._v("注入进入即可。很多人理不清这里，其实是没想明白单向依赖。")]),t._v(" "),s("h3",{attrs:{id:"_3-3-组件库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-组件库"}},[t._v("#")]),t._v(" 3.3. 组件库")]),t._v(" "),s("p",[t._v("将核心组件、核心逻辑抽离到"),s("code",[t._v("press-ui")]),t._v("，好处如下：")]),t._v(" "),s("ul",[s("li",[t._v("增强可维护性，提升开发效率\n"),s("ul",[s("li",[t._v("通过整理代码，合并属性，分离业务逻辑等，让组件变纯粹，增强可维护性，进而提升效率")])])]),t._v(" "),s("li",[t._v("减少业务和组件的耦合，降低各自复杂度，并减少bug")]),t._v(" "),s("li",[t._v("封装核心逻辑，控制变化\n"),s("ul",[s("li",[t._v("不用担心外部合作人员改乱代码，以及解决冲突时的覆盖问题")])])]),t._v(" "),s("li",[t._v("UI问题定位简单\n"),s("ul",[s("li",[t._v("三端代码同时发布，以及多种类型的示例，覆盖面全，容易发现ui问题，以及三端表现不一致问题")])])]),t._v(" "),s("li",[t._v("可提升性能\n"),s("ul",[s("li",[t._v("通过自定义队伍数等变量，定位性能瓶颈，并解决性能问题")])])]),t._v(" "),s("li",[t._v("提高可复用性，可应用到其他项目")]),t._v(" "),s("li",[t._v("技术沉淀，技术积累，不断打磨组件细节")])]),t._v(" "),s("p",[t._v("并非所有组件、逻辑都可以沉淀到组件库中，有以下准入条件：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("press-ui")]),t._v("内的组件、逻辑需要有一定的通用性或复杂性，比如"),s("code",[t._v("button")]),t._v("、"),s("code",[t._v("input")]),t._v("、"),s("code",[t._v("area")]),t._v("、"),s("code",[t._v("message-detail")]),t._v("等组件通用型强，"),s("code",[t._v("schedule-tree")]),t._v("组件复杂度高。")]),t._v(" "),s("li",[t._v("对于"),s("code",[t._v("press-ui")]),t._v("中沉淀的逻辑也是如此。")])]),t._v(" "),s("p",[s("code",[t._v("press-ui")]),t._v("的组件、逻辑都应该减少与业务的耦合，基础组件很容易做到，也很容易判断是否耦合，对于业务中沉淀下来的，如何做到呢？")]),t._v(" "),s("ul",[s("li",[t._v("不能存在业务状态码，多重判断逻辑应该前置完成")]),t._v(" "),s("li",[t._v("关注点分离，关注组件自身，而非业务")]),t._v(" "),s("li",[t._v("最少知识原则，只传入必要的参数")])]),t._v(" "),s("h3",{attrs:{id:"_3-4-循序渐进"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-循序渐进"}},[t._v("#")]),t._v(" 3.4. 循序渐进")]),t._v(" "),s("p",[t._v("重构应该每次只做一件事，避免涉及多个功能点。好的重构可以随时停下来。")]),t._v(" "),s("p",[t._v("尽量重构而不是重写，要克服重写一遍的冲动。应该发现问题就及时重构，而不是等到积重难返时，再重写，那样成本更高。")]),t._v(" "),s("h2",{attrs:{id:"_4-项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-项目"}},[t._v("#")]),t._v(" 4. 项目")]),t._v(" "),s("h3",{attrs:{id:"_4-1-轮次设置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-轮次设置"}},[t._v("#")]),t._v(" 4.1. 轮次设置")]),t._v(" "),s("p",[t._v("对于某项目的轮次设置页面，进行分层如下：")]),t._v(" "),s("img",{attrs:{src:"https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2023/6/own_mike_33cb598ce7694ab072.png",width:"800"}}),t._v(" "),s("ul",[s("li",[s("code",[t._v("config")]),t._v("主要是常量定义")]),t._v(" "),s("li",[s("code",[t._v("helper")]),t._v("包含一些辅助工具，比如对时间做格式化")]),t._v(" "),s("li",[s("code",[t._v("popup")]),t._v("是一些函数式调用组件")]),t._v(" "),s("li",[s("code",[t._v("page")]),t._v("引用了"),s("code",[t._v("component")]),t._v("组件和"),s("code",[t._v("popup")])]),t._v(" "),s("li",[s("code",[t._v("logic")]),t._v("包含请求接口逻辑")]),t._v(" "),s("li",[s("code",[t._v("operation")]),t._v("包含对"),s("code",[t._v("logic")]),t._v("的封装，比如错误提示、检查已经开赛的比赛个数等")])]),t._v(" "),s("p",[t._v("函数式调用可以减少中间变量，比如上面的页面，有很多弹出层，且是嵌套的逻辑。点击A弹出B，点击B弹出C，点击C中的某个选项又要回到B，这其中涉及很多中间状态，需要写很多的"),s("code",[t._v("data")]),t._v("、"),s("code",[t._v("computed")]),t._v("、"),s("code",[t._v("methods")]),t._v("，用函数调用的方式可以大大减少这种中间变量，使逻辑更内聚，不容易出bug。")]),t._v(" "),s("p",[t._v("重构后的效果：")]),t._v(" "),s("ul",[s("li",[t._v("页面之前1600行，重构后降到500多行")]),t._v(" "),s("li",[t._v("减少了中间变量，逻辑内聚、清晰")]),t._v(" "),s("li",[t._v("减少了其他文件对页面"),s("code",[t._v("this")]),t._v("的引用，减少耦合")])]),t._v(" "),s("h3",{attrs:{id:"_4-2-赛程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-赛程"}},[t._v("#")]),t._v(" 4.2. 赛程")]),t._v(" "),s("p",[t._v("首先，赛程相关部分的命名有些混乱， 对他们进行了统一。")]),t._v(" "),s("p",[t._v("将赛程树核心组件抽离，并遵循最小知识原则，"),s("code",[t._v("roundList")]),t._v("由"),s("code",[t._v("scheList")]),t._v("计算生成，不再由外部传入。")]),t._v(" "),s("p",[t._v("对中间层做了公共"),s("code",[t._v("props")]),t._v("的抽离。这个中间层链接了多种赛制，是"),s("code",[t._v("props")]),t._v("、"),s("code",[t._v("events")]),t._v("传递的桥梁。")]),t._v(" "),s("img",{attrs:{src:"https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2023/7/own_mike_ff4f7ae03fe9f8c5b5.png",width:"900"}}),t._v(" "),s("h3",{attrs:{id:"_4-3-消息中心"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-消息中心"}},[t._v("#")]),t._v(" 4.3. 消息中心")]),t._v(" "),s("img",{attrs:{src:"https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2023/7/own_mike_046cf397f4650b00e5.png",width:"900"}}),t._v(" "),s("p",[t._v("对消息中心数据的处理逻辑进行了梳理：")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("App.vue")]),t._v("中"),s("code",[t._v("dispatch")]),t._v("一些"),s("code",[t._v("actions")]),t._v("，如"),s("code",[t._v("getTimUnReadCount")]),t._v("、"),s("code",[t._v("getTimRobotMessage")]),t._v("，调用后台CGI，给到"),s("code",[t._v("store")]),t._v("，全局消息弹窗获取此数据。")]),t._v(" "),s("li",[t._v("需要IM的页面，引入"),s("code",[t._v("IM Mixin")]),t._v("，进行IM的登录、获取会话列表、设置事件回调等，同样给到"),s("code",[t._v("store")]),t._v("，"),s("code",[t._v("Page")]),t._v("、"),s("code",[t._v("Global Notify")]),t._v("可以使用此数据。")])]),t._v(" "),s("p",[t._v("为什么搞这么复杂，省掉第一步不行吗？不行，因为IM SDK包太大，不能放在主包，所以需要Page层自己引入，而首页又需要消息提示，所以调用后台CGI，后台接口会调用IM的API获取消息。")]),t._v(" "),s("p",[t._v("另外，对消息列表、消息详情等组件进行了抽离，放到了"),s("code",[t._v("press-ui")]),t._v("中，并且对格式化消息的核心逻辑进行了分离和沉淀。")]),t._v(" "),s("h3",{attrs:{id:"_4-4-分享模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-分享模块"}},[t._v("#")]),t._v(" 4.4. 分享模块")]),t._v(" "),s("p",[t._v("分享模块存在的问题包括：")]),t._v(" "),s("ul",[s("li",[t._v("通过文件顶层变量进行属性共享，难追踪，难维护")]),t._v(" "),s("li",[t._v("与项目耦合，比如依赖"),s("code",[t._v("getWxSignature")]),t._v("、"),s("code",[t._v("getMPOpenLink")])]),t._v(" "),s("li",[t._v("与框架耦合，比如依赖"),s("code",[t._v("van-dialog")]),t._v("、"),s("code",[t._v("vue")])]),t._v(" "),s("li",[t._v("扩展性差，比如游戏内不支持指定分享类型，需业务库自行处理")]),t._v(" "),s("li",[t._v("无类型提示，黑盒子，易出错")])]),t._v(" "),s("p",[t._v("如何优化？")]),t._v(" "),s("p",[t._v("对于全局变量，改为"),s("code",[t._v("class")]),t._v("，之前：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// share.js")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" shareObject "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" shareUiObj "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("obj")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  shareObject "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" obj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  shareUiObj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("initCommShareUI")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ....")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("现在:")]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// config.ts")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ShareConfig")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" shareObject"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" IShareObject"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" shareUiObj"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" IShareUiObj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setShareObject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("shareObject"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" IShareObject"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shareObject "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shareObject"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("shareObject"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setShareUI")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("shareUiObj"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("  IShareUiObj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shareUiObj "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shareUiObj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("shareUiObj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// share.ts")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  ShareConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setShareObject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  ShareConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setShareUI")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initCommShareUI")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("对于与业务项目耦合的部分，比如"),s("code",[t._v("getWxSignature")]),t._v("、"),s("code",[t._v("getMPOpenLink")]),t._v("等方法，每个业务不一样，可以通过参数传递的方式，即参数为函数。")]),t._v(" "),s("p",[s("code",[t._v("core")]),t._v("不需要关心"),s("code",[t._v("getMPOpenLink")]),t._v("的所有参数，比如"),s("code",[t._v("appid")]),t._v("、"),s("code",[t._v("mpPath")]),t._v("、"),s("code",[t._v("query")]),t._v("等，外界自己处理就行。")]),t._v(" "),s("p",[t._v("对于与框架耦合的部分，直接改成原生实现，不依赖任何框架。以后扩展到"),s("code",[t._v("vue3")]),t._v("、"),s("code",[t._v("react")]),t._v("，或者更新组件库，比如不再引入"),s("code",[t._v("Vant")]),t._v("，该模块都无需做任何改动。")]),t._v(" "),s("p",[t._v("另外，可变部分都放到参数里，并补全类型提示。")]),t._v(" "),s("h2",{attrs:{id:"_5-耦合"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-耦合"}},[t._v("#")]),t._v(" 5. 耦合")]),t._v(" "),s("p",[t._v("下面列举几种工作中常见的耦合。")]),t._v(" "),s("h3",{attrs:{id:"_5-1-在window上挂载并修改变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-在window上挂载并修改变量"}},[t._v("#")]),t._v(" 5.1. 在window上挂载并修改变量")]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// common/vue/mixin/option/settingMixins.ts")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("readRecommendStatus")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n  window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isOpenRecommend "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" isOpen "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("这种使用方式不可控，你不知道这个值被什么人修改，在哪里修改，难以调试，难以定位问题。")]),t._v(" "),s("p",[t._v("除非这个变量在整个项目中是唯一的，独特的，比如"),s("code",[t._v("window.vConsole")]),t._v("、"),s("code",[t._v("window.aegis")]),t._v("，这种在所有开发者中间有共识的，可以挂载，但是永远不可以修改。")]),t._v(" "),s("h3",{attrs:{id:"_5-2-在文件中设置全局变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-在文件中设置全局变量"}},[t._v("#")]),t._v(" 5.2. 在文件中设置全局变量")]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// common/tools/share/share-web/index.js")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" shareObject "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("initShare")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("params "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" obj "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  obj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("title "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" obj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("title "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementsByTagName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'title'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?.")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?.")]),t._v("innerText"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n  shareObject "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" obj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("当文件很小，内容很少时，文件顶部的全局变量不会出现问题。但是，当这个全局变量被很多方法使用，在很多地方都被更改时，就变得不可控了。比如"),s("code",[t._v("share")]),t._v("模块比较复杂，需适配许多场景，就不适合用这种方法。")]),t._v(" "),s("p",[t._v("所以要使用这种方式也可以，需保证文件不要太大，更新它的地方不要太多。")]),t._v(" "),s("h3",{attrs:{id:"_5-3-引入外部模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-引入外部模块"}},[t._v("#")]),t._v(" 5.3. 引入外部模块")]),t._v(" "),s("p",[t._v("引入外部模块并使用，是天经地义的事情，似乎并没有什么问题。但是当你维护的是一个底层库、工具库、组件库的时候，就要考虑引入的这个东西是不是稳定的？是不是业务的？有没有违背单向依赖原则？")]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" miniJumpLogic "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../../minijump'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("openWeixinOpenLink")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("shareObject"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" failedCallback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" shareObject"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("split")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'?'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  miniJumpLogic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("postGetMiniProgramOpenLink")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    adcfg"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    appid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getJumpMiniProgramAppid")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("shareObject"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("gid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    param_data"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    jump_type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JUMP_TYPES")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CUSTOM_NO_ENCODE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("response"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("response"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?.")]),t._v("open_link"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("href "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" response"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("open_link"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("failedCallback "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" failedCallback "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'function'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("failedCallback")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initInGameShare")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("slugSDKShareDelegate")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("openWeixinOpenLink")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("shareObject"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("customBrowserInterface"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sendToWeixinWithUrl")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        shareObject"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("title"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        shareObject"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("desc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        shareObject"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("link"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        shareObject"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("icon"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("上面代码是分享模块的一段逻辑，意思是游戏内分享的时候，优先获取"),s("code",[t._v("openLink")]),t._v("，然后跳转小程序。这段代码的问题是不应该引用"),s("code",[t._v("logic")]),t._v("的"),s("code",[t._v("postGetMiniProgramOpenLink")]),t._v("方法，这个是上层的业务的，不稳定，且违背了单向依赖原则。")]),t._v(" "),s("p",[t._v("可以用“依赖注入”的思想，把此方法作为参数注入。")]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("openWeixinOpenLink")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  failedCallback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  getMiniProgramOpenLink"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  failedCallback"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("Function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  getMiniProgramOpenLink"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" IGetMiniProgramOpenLink"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" getMiniProgramOpenLink "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'undefined'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    failedCallback"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?.")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMiniProgramOpenLink")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("response"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("response"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?.")]),t._v("open_link"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("href "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" response"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("open_link"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        failedCallback"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?.")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("catch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      failedCallback"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?.")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"_5-4-refs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-refs"}},[t._v("#")]),t._v(" 5.4. refs")]),t._v(" "),s("p",[t._v("用"),s("code",[t._v("$refs.oneRef.someMethod")]),t._v("操作子组件方法，适合用于稳定组件，如果是频繁变动的业务库，就存在被人改动、然后异常的风险。")])])}),[],!1,null,null,null);s.default=e.exports}}]);