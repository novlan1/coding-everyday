(window.webpackJsonp=window.webpackJsonp||[]).push([[320],{592:function(t,a,s){"use strict";s.r(a);var n=s(14),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("ul",[a("li",[a("a",{attrs:{href:"#1-%E5%89%8D%E7%AB%AF%E7%9B%91%E6%8E%A7%E5%88%86%E7%B1%BB"}},[t._v("1. 前端监控分类")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#11-%E6%95%B0%E6%8D%AE%E7%9B%91%E6%8E%A7"}},[t._v("1.1. 数据监控")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#12-%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7"}},[t._v("1.2. 性能监控")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#13-%E5%BC%82%E5%B8%B8%E7%9B%91%E6%8E%A7"}},[t._v("1.3. 异常监控")])])])]),t._v(" "),a("li",[a("a",{attrs:{href:"#2-%E9%94%99%E8%AF%AF%E7%9B%91%E6%8E%A7"}},[t._v("2. 错误监控")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#21-%E8%84%9A%E6%9C%AC%E9%94%99%E8%AF%AF%E7%9B%91%E6%8E%A7"}},[t._v("2.1. 脚本错误监控")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#211-%E5%B8%B8%E8%A7%84%E8%84%9A%E6%9C%AC%E9%94%99%E8%AF%AF"}},[t._v("2.1.1. 常规脚本错误")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#212-promise-%E9%94%99%E8%AF%AF"}},[t._v("2.1.2. Promise 错误")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#213-%E8%B7%A8%E5%9F%9F%E8%84%9A%E6%9C%AC%E9%94%99%E8%AF%AF%E6%8D%95%E8%8E%B7"}},[t._v("2.1.3. 跨域脚本错误捕获")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#214-%E6%A1%86%E6%9E%B6%E9%94%99%E8%AF%AF"}},[t._v("2.1.4. 框架错误")])])])]),t._v(" "),a("li",[a("a",{attrs:{href:"#22-%E8%AF%B7%E6%B1%82%E9%94%99%E8%AF%AF%E7%9B%91%E6%8E%A7"}},[t._v("2.2. 请求错误监控")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#23-%E8%B5%84%E6%BA%90%E9%94%99%E8%AF%AF%E7%9B%91%E6%8E%A7"}},[t._v("2.3. 资源错误监控")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#231-objectonerror"}},[t._v("2.3.1. "),a("code",[t._v("object.onerror")])])]),t._v(" "),a("li",[a("a",{attrs:{href:"#performancegetentries"}},[a("code",[t._v("performance.getEntries()")])])]),t._v(" "),a("li",[a("a",{attrs:{href:"#232-window-%E5%AF%B9%E8%B1%A1%E4%B8%8A%E9%80%9A%E8%BF%87%E4%BA%8B%E4%BB%B6%E6%8D%95%E8%8E%B7-error-%E4%BA%8B%E4%BB%B6"}},[t._v("2.3.2. "),a("code",[t._v("window")]),t._v(" 对象上通过事件捕获 "),a("code",[t._v("Error")]),t._v(" 事件")])])])]),t._v(" "),a("li",[a("a",{attrs:{href:"#24-%E4%B8%8A%E6%8A%A5%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF"}},[t._v("2.4. 上报错误信息")])])])])]),t._v(" "),a("h3",{attrs:{id:"_1-前端监控分类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-前端监控分类"}},[t._v("#")]),t._v(" 1. 前端监控分类")]),t._v(" "),a("p",[t._v("前端监控可以分为三类："),a("strong",[t._v("数据监控、性能监控和异常监控")]),t._v("。")]),t._v(" "),a("h4",{attrs:{id:"_1-1-数据监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-数据监控"}},[t._v("#")]),t._v(" 1.1. 数据监控")]),t._v(" "),a("p",[t._v("数据监控，顾名思义就是监听用户的行为。常见的数据监控包括：")]),t._v(" "),a("ul",[a("li",[t._v("PV/UV:PV(page view)，即页面浏览量或点击量。UV:指访问某个站点或点击某条新闻的不同IP地址的人数")]),t._v(" "),a("li",[t._v("用户在每一个页面的停留时间")]),t._v(" "),a("li",[t._v("用户通过什么入口来访问该网页")]),t._v(" "),a("li",[t._v("用户在相应的页面中触发的行为")])]),t._v(" "),a("p",[t._v("统计这些数据是有意义的，比如我们知道了用户来源的渠道，可以促进产品的推广，知道用户在每一个页面停留的时间，可以针对停留较长的页面，增加广告推送等等。")]),t._v(" "),a("h4",{attrs:{id:"_1-2-性能监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-性能监控"}},[t._v("#")]),t._v(" 1.2. 性能监控")]),t._v(" "),a("p",[t._v("性能监控指的是监听前端的性能，主要包括监听网页或者说产品在用户端的体验。常见的性能监控数据包括：")]),t._v(" "),a("ul",[a("li",[t._v("不同用户，不同机型和不同系统下的首屏加载时间")]),t._v(" "),a("li",[t._v("白屏时间")]),t._v(" "),a("li",[t._v("http等请求的响应时间")]),t._v(" "),a("li",[t._v("静态资源整体下载时间")]),t._v(" "),a("li",[t._v("页面渲染时间")]),t._v(" "),a("li",[t._v("页面交互动画完成时间")])]),t._v(" "),a("p",[t._v("这些性能监控的结果，可以展示前端性能的好坏，根据性能监测的结果可以进一步的去优化前端性能，比如兼容低版本浏览器的动画效果，加快首屏加载等等。")]),t._v(" "),a("h4",{attrs:{id:"_1-3-异常监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-异常监控"}},[t._v("#")]),t._v(" 1.3. 异常监控")]),t._v(" "),a("p",[t._v("此外，产品的前端代码在执行过程中也会发生异常，因此需要引入异常监控。及时的上报异常情况，可以避免线上故障的发上。虽然大部分异常可以通过"),a("code",[t._v("try catch")]),t._v("的方式捕获，但是比如内存泄漏以及其他偶现的异常难以捕获。常见的需要监控的异常包括：")]),t._v(" "),a("ul",[a("li",[t._v("Javascript的异常监控")]),t._v(" "),a("li",[t._v("样式丢失的异常监控")])]),t._v(" "),a("h3",{attrs:{id:"_2-错误监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-错误监控"}},[t._v("#")]),t._v(" 2. 错误监控")]),t._v(" "),a("p",[t._v("错误监控可以分为："),a("strong",[t._v("脚本错误监控、请求错误监控以及资源错误监控")]),t._v("。")]),t._v(" "),a("h4",{attrs:{id:"_2-1-脚本错误监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-脚本错误监控"}},[t._v("#")]),t._v(" 2.1. 脚本错误监控")]),t._v(" "),a("p",[t._v("脚本错误大体可以分为两种："),a("strong",[t._v("编译时错误以及运行时错误")]),t._v("。其中，"),a("strong",[t._v("编译时错误一般在开发阶段就会发现")]),t._v("，配合 "),a("code",[t._v("lint")]),t._v(" 工具比如 "),a("code",[t._v("eslint")]),t._v("、"),a("code",[t._v("tslint")]),t._v(" 等以及 "),a("code",[t._v("git")]),t._v(" 提交插件比如 "),a("code",[t._v("husky")]),t._v(" 等，基本可以保证线上代码不出现低级的编译时错误。")]),t._v(" "),a("p",[t._v("在编写 "),a("code",[t._v("JavaScript")]),t._v(" 时，我们为了防止出现错误阻塞程序，我们会通过 "),a("code",[t._v("try catch")]),t._v(" 捕获错误，对于错误捕获，这是最简单也是最通用的方案。")]),t._v(" "),a("p",[t._v("但是，"),a("code",[t._v("try catch")]),t._v(" 捕获错误是侵入式的，需要在开发代码时即提前进行处理，而作为一个监控系统，无法做到在所有可能产生错误的代码片段中都嵌入 "),a("code",[t._v("try catch")]),t._v("。所以，我们需要全局捕获脚本错误。")]),t._v(" "),a("h5",{attrs:{id:"_2-1-1-常规脚本错误"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-常规脚本错误"}},[t._v("#")]),t._v(" 2.1.1. 常规脚本错误")]),t._v(" "),a("p",[a("strong",[t._v("当页面出现脚本错误时，就会产生 "),a("code",[t._v("onerror")]),t._v(" 事件，我们只需捕获该事件即可")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * @description window.onerror 全局捕获错误\n * @param event 错误信息，如果是\n * @param source 错误源文件URL\n * @param lineno 行号\n * @param colno 列号\n * @param error Error对象\n */")]),t._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onerror")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lineno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" colno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 上报错误")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果不想在控制台抛出错误，只需返回 true 即可")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("code",[t._v("window.onerror")]),t._v(" 有两个缺点：")]),t._v(" "),a("ol",[a("li",[a("strong",[t._v("只能绑定一个回调函数，如果想在不同文件中想绑定不同的回调函数，"),a("code",[t._v("window.onerror")]),t._v(" 显然无法完成")]),t._v("；同时，不同回调函数直接容易造成互相覆盖。")]),t._v(" "),a("li",[t._v("回调函数的参数过于离散，使用不方便")])]),t._v(" "),a("p",[t._v("所以，一般情况下，我们使用 "),a("code",[t._v("addEventListener")]),t._v(" 来代替。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * @param event 事件名\n * @param function 回调函数\n * @param useCapture 回调函数是否在捕获阶段执行，默认是false，在冒泡阶段执行\n */")]),t._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'error'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// addEventListener 回调函数的离散参数全部聚合在 error 对象中")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 上报错误")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("在一些特殊情况下，我们依然需要使用 "),a("code",[t._v("window.onerror")]),t._v("。比如，"),a("strong",[t._v("不期望在控制台抛出错误时，因为只有 "),a("code",[t._v("window.onerror")]),t._v(" 才能阻止抛出错误到控制台")])]),t._v(" "),a("h5",{attrs:{id:"_2-1-2-promise-错误"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2-promise-错误"}},[t._v("#")]),t._v(" 2.1.2. Promise 错误")]),t._v(" "),a("p",[t._v("和常规脚本错误的捕获一样，我们只需捕获 "),a("code",[t._v("Promise")]),t._v(" 对应的错误事件即可。"),a("strong",[t._v("而 "),a("code",[t._v("Promise")]),t._v(" 错误事件有两种，"),a("code",[t._v("unhandledrejection")]),t._v(" 以及 "),a("code",[t._v("rejectionhandled")])]),t._v("。")]),t._v(" "),a("ol",[a("li",[t._v("当 "),a("code",[t._v("Promise")]),t._v(" 被 "),a("code",[t._v("reject")]),t._v(" 且没有 "),a("code",[t._v("reject")]),t._v(" 处理器的时候，会触发 "),a("code",[t._v("unhandledrejection")]),t._v(" 事件。")]),t._v(" "),a("li",[t._v("当 "),a("code",[t._v("Promise")]),t._v(" 被 "),a("code",[t._v("reject")]),t._v(" 且有 "),a("code",[t._v("reject")]),t._v(" 处理器的时候，会触发 "),a("code",[t._v("rejectionhandled")]),t._v(" 事件。")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// unhandledrejection 推荐处理方案")]),t._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'unhandledrejection'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// unhandledrejection 备选处理方案")]),t._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onunhandledrejection")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// rejectionhandled 推荐处理方案")]),t._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rejectionhandled'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// rejectionhandled 备选处理方案")]),t._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onrejectionhandled")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h5",{attrs:{id:"_2-1-3-跨域脚本错误捕获"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-3-跨域脚本错误捕获"}},[t._v("#")]),t._v(" 2.1.3. 跨域脚本错误捕获")]),t._v(" "),a("p",[a("strong",[t._v("在 "),a("code",[t._v("script")]),t._v(" 标签中，添加 "),a("code",[t._v("crossorigin")]),t._v(" 属性（推荐使用 "),a("code",[t._v("webpack")]),t._v(" 插件自动添加）；同时，配置 CDN 服务器，为跨域脚本配上 "),a("code",[t._v("CORS")])]),t._v("。")]),t._v(" "),a("p",[t._v("该方案有一个隐藏的坑，即兼容性问题，"),a("code",[t._v("crossorigin")]),t._v(" 属性对于 IE 以及 Safari 支持程度不高。")]),t._v(" "),a("h5",{attrs:{id:"_2-1-4-框架错误"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-4-框架错误"}},[t._v("#")]),t._v(" 2.1.4. 框架错误")]),t._v(" "),a("p",[t._v("框架错误指的不是框架层面的错误，而是指框架提供了 API 来捕获全局错误。")]),t._v(" "),a("p",[t._v("在 Vue 中，框架提供了 "),a("code",[t._v("errorHandler")]),t._v(" 这个 API 来捕获并处理错误。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("Vue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("errorHandler")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// handle error")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// `info` 是 Vue 特定的错误信息，比如错误所在的生命周期钩子")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 只在 2.2.0+ 可用")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h4",{attrs:{id:"_2-2-请求错误监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-请求错误监控"}},[t._v("#")]),t._v(" 2.2. 请求错误监控")]),t._v(" "),a("p",[t._v("一般来说，前端请求有两种方案，使用 "),a("code",[t._v("ajax")]),t._v(" 或者 "),a("code",[t._v("fetch")]),t._v(" ，所以只需重写两种方法，进行代理，即可实现请求错误监控。")]),t._v(" "),a("p",[t._v("代理的核心在于使用 "),a("code",[t._v("apply")]),t._v(" 重新执行原有方法，并且在执行原有方法之前进行监听操作。"),a("strong",[t._v("在请求错误监控中，我们关心三种错误事件："),a("code",[t._v("abort")]),t._v("，"),a("code",[t._v("error")]),t._v(" 以及 "),a("code",[t._v("timeout")])]),t._v("，所以，只需在代理中对这三种事件进行统一处理即可。")]),t._v(" "),a("p",[t._v("tips：如果能够统一使用一种请求工具，如 "),a("code",[t._v("axios")]),t._v(" 等，那么不需要重写 "),a("code",[t._v("ajax")]),t._v(" 或者 "),a("code",[t._v("fetch")]),t._v(" 只需在请求拦截器以及响应拦截器进行处理上报即可")]),t._v(" "),a("h4",{attrs:{id:"_2-3-资源错误监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-资源错误监控"}},[t._v("#")]),t._v(" 2.3. 资源错误监控")]),t._v(" "),a("h5",{attrs:{id:"_2-3-1-object-onerror"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-1-object-onerror"}},[t._v("#")]),t._v(" 2.3.1. "),a("code",[t._v("object.onerror")])]),t._v(" "),a("p",[a("strong",[a("code",[t._v("image")]),t._v(" "),a("code",[t._v("标签、script")]),t._v(" 标签上都可以加 "),a("code",[t._v("onerror")]),t._v(" 事件")])]),t._v(" "),a("h5",{attrs:{id:"performance-getentries"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#performance-getentries"}},[t._v("#")]),t._v(" "),a("code",[t._v("performance.getEntries()")])]),t._v(" "),a("p",[t._v("获取所有已经加载资源的获取时长")]),t._v(" "),a("h5",{attrs:{id:"_2-3-2-window-对象上通过事件捕获-error-事件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-2-window-对象上通过事件捕获-error-事件"}},[t._v("#")]),t._v(" 2.3.2. "),a("code",[t._v("window")]),t._v(" 对象上通过事件捕获 "),a("code",[t._v("Error")]),t._v(" 事件")]),t._v(" "),a("p",[t._v("资源错误监控本质上和常规脚本错误监控一样，都是监控错误事件实现错误捕获。")]),t._v(" "),a("p",[a("strong",[t._v("那么如何区分脚本错误还是资源错误呢")]),t._v("？我们可以通过 "),a("code",[t._v("instanceof")]),t._v(" 区分，"),a("strong",[t._v("脚本错误参数对象 "),a("code",[t._v("instanceof ErrorEvent")]),t._v("，而资源错误的参数对象 "),a("code",[t._v("instanceof Event")])]),t._v("。")]),t._v(" "),a("p",[t._v("值得一提的是，由于 "),a("code",[t._v("ErrorEvent")]),t._v(" 继承于 "),a("code",[t._v("Event")]),t._v(" ，所以不管是脚本错误还是资源错误的参数对象，它们都 "),a("code",[t._v("instanceof Event")]),t._v("，所以，"),a("strong",[t._v("需要先判断脚本错误")]),t._v("。")]),t._v(" "),a("p",[t._v("此外，两个参数对象之间有一些细微的不同，比如，脚本错误的参数对象中包含 "),a("code",[t._v("message")]),t._v(" ，而资源错误没有，这些都可以作为判断资源错误或者脚本错误的依据。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * @param event 事件名\n * @param function 回调函数\n * @param useCapture 回调函数是否在捕获阶段执行，默认是false，在冒泡阶段执行\n */")]),t._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'error'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("instanceof")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ErrorEvent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'脚本错误'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("instanceof")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Event")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'资源错误'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("tips："),a("strong",[t._v("使用 "),a("code",[t._v("addEventListener")]),t._v(" 捕获资源错误时，一定要将 "),a("code",[t._v("useCapture")]),t._v(" 即第三个选项设为 "),a("code",[t._v("true")]),t._v("，因为资源错误没有冒泡，所以只能在捕获阶段捕获")]),t._v("。‘\n同理，"),a("strong",[t._v("由于 "),a("code",[t._v("window.onerror")]),t._v(" 是通过在冒泡阶段捕获错误，所以无法捕获资源错误")]),t._v("。")]),t._v(" "),a("h4",{attrs:{id:"_2-4-上报错误信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-上报错误信息"}},[t._v("#")]),t._v(" 2.4. 上报错误信息")]),t._v(" "),a("ol",[a("li",[a("strong",[t._v("采用 "),a("code",[t._v("Ajax")]),t._v(" 通信上报")])]),t._v(" "),a("li",[a("strong",[t._v("利用 "),a("code",[t._v("image")]),t._v(" 对象的 "),a("code",[t._v("src")]),t._v(" 属性上报")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);