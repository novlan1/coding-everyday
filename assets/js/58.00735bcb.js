(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{580:function(_,v,e){_.exports=e.p+"assets/img/b_s_cache.3e92b63d.png"},708:function(_,v,e){"use strict";e.r(v);var t=e(42),o=Object(t.a)({},(function(){var _=this,v=_.$createElement,t=_._self._c||v;return t("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[t("ul",[t("li",[t("a",{attrs:{href:"#1-cache-control-%E5%B1%9E%E6%80%A7%E6%9C%89%E5%93%AA%E4%BA%9B"}},[_._v("1. cache-control 属性有哪些？")]),_._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"#11-immutable"}},[_._v("1.1. "),t("code",[_._v("immutable")])])])])]),_._v(" "),t("li",[t("a",{attrs:{href:"#2-%E5%8D%8F%E5%95%86%E7%BC%93%E5%AD%98%E8%A7%A6%E5%8F%91%E6%9D%A1%E4%BB%B6"}},[_._v("2. 协商缓存触发条件")])]),_._v(" "),t("li",[t("a",{attrs:{href:"#3-%E5%BC%BA%E7%BC%93%E5%AD%98%E5%92%8C%E5%8D%8F%E5%95%86%E7%BC%93%E5%AD%98"}},[_._v("3. 强缓存和协商缓存")])]),_._v(" "),t("li",[t("a",{attrs:{href:"#4-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E6%9C%89etag"}},[_._v("4. 为什么要有etag？")])]),_._v(" "),t("li",[t("a",{attrs:{href:"#5-%E8%BE%93%E5%85%A5urlf5-ctrl--f5-%E7%9A%84%E5%8C%BA%E5%88%AB"}},[_._v("5. 输入URL、"),t("code",[_._v("F5")]),_._v("、 "),t("code",[_._v("Ctrl + F5")]),_._v(" 的区别")])]),_._v(" "),t("li",[t("a",{attrs:{href:"#6-%E7%BC%93%E5%AD%98%E7%A7%8D%E7%B1%BB"}},[_._v("6. 缓存种类")])]),_._v(" "),t("li",[t("a",{attrs:{href:"#7-%E5%AE%9E%E9%99%85%E5%9C%BA%E6%99%AF%E5%BA%94%E7%94%A8%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5"}},[_._v("7. 实际场景应用缓存策略")]),_._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"#71-%E9%A2%91%E7%B9%81%E5%8F%98%E5%8A%A8%E7%9A%84%E8%B5%84%E6%BA%90"}},[_._v("7.1. 频繁变动的资源")])]),_._v(" "),t("li",[t("a",{attrs:{href:"#72-%E4%B8%8D%E5%B8%B8%E5%8F%98%E5%8C%96%E7%9A%84%E8%B5%84%E6%BA%90"}},[_._v("7.2. 不常变化的资源")])])])])]),_._v(" "),t("h3",{attrs:{id:"_1-cache-control-属性有哪些"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-cache-control-属性有哪些"}},[_._v("#")]),_._v(" 1. cache-control 属性有哪些？")]),_._v(" "),t("ol",[t("li",[t("code",[_._v("cache-control: max-age=xxxx，public")])])]),_._v(" "),t("p",[t("strong",[_._v("客户端和代理服务器")]),_._v("都可以缓存该资源；\n客户端在xxx秒的有效期内，如果有请求该资源的需求的话就直接读取缓存，"),t("code",[_._v("statu code:200")]),_._v(" ，如果用户做了刷新操作，就向服务器发起http请求")]),_._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[t("code",[_._v("cache-control: max-age=xxxx，private")])])]),_._v(" "),t("p",[_._v("只让"),t("strong",[_._v("客户端")]),_._v("可以缓存该资源；"),t("strong",[_._v("代理服务器不缓存")]),_._v("\n客户端在xxx秒内直接读取缓存，"),t("code",[_._v("statu code:200")])]),_._v(" "),t("ol",{attrs:{start:"3"}},[t("li",[t("code",[_._v("cache-control: max-age=xxxx，immutable")])])]),_._v(" "),t("p",[_._v("客户端在xxx秒的有效期内，如果有请求该资源的需求的话就直接读取缓存，"),t("code",[_._v("statu code:200")]),_._v(" ，即使用户做了刷新操作，也不向服务器发起http请求")]),_._v(" "),t("ol",{attrs:{start:"4"}},[t("li",[t("code",[_._v("cache-control: no-cache")])])]),_._v(" "),t("p",[t("strong",[_._v("跳过设置强缓存")]),_._v("，但是不妨碍设置协商缓存；一般如果你做了强缓存，只有在强缓存失效了才走协商缓存的，设置了"),t("code",[_._v("no-cache")]),_._v("就不会走强缓存了，每次请求都回询问服务端。")]),_._v(" "),t("ol",{attrs:{start:"5"}},[t("li",[t("code",[_._v("cache-control: no-store")])])]),_._v(" "),t("p",[_._v("不缓存，这个会让"),t("strong",[_._v("客户端、服务器都不缓存")]),_._v("，也就"),t("strong",[_._v("没有所谓的强缓存、协商缓存")]),_._v("了。")]),_._v(" "),t("h4",{attrs:{id:"_1-1-immutable"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-immutable"}},[_._v("#")]),_._v(" 1.1. "),t("code",[_._v("immutable")])]),_._v(" "),t("p",[t("code",[_._v("immutable")]),_._v(" 为了让用户在刷新页面的时候不要去请求服务器。")]),_._v(" "),t("p",[t("code",[_._v("Cache-Control: max-age=3600, immutable")]),_._v("，表明该资源能存活一小时，在一小时之内，即便用户刷新也不要发送条件请求，不走协商缓存的流程。")]),_._v(" "),t("p",[_._v("在过期之后，浏览器会发送一个不带"),t("code",[_._v("If-Modified-Since")]),_._v("和"),t("code",[_._v("If-None-Match")]),_._v("的请求来更新资源。")]),_._v(" "),t("p",[_._v("这里需要注意，一旦被标志成 immutable，则这个资源不可能返回 304 响应了，只有 200（Chrome 开发者工具的network里面size会显示为"),t("code",[_._v("from memory cache/from disk cache")]),_._v("）。")]),_._v(" "),t("h3",{attrs:{id:"_2-协商缓存触发条件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-协商缓存触发条件"}},[_._v("#")]),_._v(" 2. 协商缓存触发条件")]),_._v(" "),t("ol",[t("li",[t("code",[_._v("Cache-Control")]),_._v("的值为"),t("code",[_._v("no-cache")]),_._v(" （不强缓存）")]),_._v(" "),t("li",[_._v("或者"),t("code",[_._v("max-age")]),_._v("过期了 （强缓存，但总有过期的时候）")])]),_._v(" "),t("h3",{attrs:{id:"_3-强缓存和协商缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-强缓存和协商缓存"}},[_._v("#")]),_._v(" 3. 强缓存和协商缓存")]),_._v(" "),t("p",[_._v("强缓存：")]),_._v(" "),t("ul",[t("li",[t("code",[_._v("cache-control")]),_._v("的单位是秒")]),_._v(" "),t("li",[t("code",[_._v("Expire")]),_._v("绝对时间，"),t("code",[_._v("cache-control")]),_._v("是相对时间，以后者为准")])]),_._v(" "),t("p",[_._v("协商缓存：")]),_._v(" "),t("ul",[t("li",[t("code",[_._v("Last-Modified")]),_._v("是服务器下发的，"),t("code",[_._v("If-Modified-Since")]),_._v("是浏览器发送到的，记录的时间，有可能时间变了，内容不变")]),_._v(" "),t("li",[t("code",[_._v("Etag")]),_._v("是变的是内容才会再次请求，对应的是"),t("code",[_._v("If-None-Match")])])]),_._v(" "),t("img",{attrs:{src:e(580),height:"500"}}),_._v(" "),t("ol",[t("li",[_._v("图上说的「"),t("code",[_._v("Etag")]),_._v("? -> 否」是指没有 "),t("code",[_._v("ETag")]),_._v("，而不是 "),t("code",[_._v("ETag")]),_._v(" 不同。")]),_._v(" "),t("li",[_._v("图上的错误则是，"),t("code",[_._v("RFC")]),_._v(" 规定，如果 "),t("code",[_._v("ETag")]),_._v(" 和 "),t("code",[_._v("Last-Modified")]),_._v(" 都有，则必须一次性都发给服务器，没有优先级。")]),_._v(" "),t("li",[_._v("最后，如果服务器输出了 "),t("code",[_._v("ETag")]),_._v("，没有必要再输出 "),t("code",[_._v("Last-Modified")]),_._v("。")])]),_._v(" "),t("h3",{attrs:{id:"_4-为什么要有etag"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-为什么要有etag"}},[_._v("#")]),_._v(" 4. 为什么要有etag？")]),_._v(" "),t("p",[_._v("你可能会觉得使用"),t("code",[_._v("last-modified")]),_._v("已经足以让浏览器知道本地的缓存副本是否足够新，为什么还需要"),t("code",[_._v("etag")]),_._v("呢？HTTP1.1中etag的出现（也就是说，etag是新增的，为了解决之前只有"),t("code",[_._v("If-Modified")]),_._v("的缺点）主要是为了解决几个l"),t("code",[_._v("ast-modified")]),_._v("比较难解决的问题：")]),_._v(" "),t("ol",[t("li",[_._v("一些文件也许会"),t("strong",[_._v("周期性的更改")]),_._v("，但是他的"),t("strong",[_._v("内容并不改变(仅仅改变的修改时间)")]),_._v("，这个时候我们并不希望客户端认为这个文件被修改了，而重新get；")]),_._v(" "),t("li",[_._v("某些文件"),t("strong",[_._v("修改非常频繁")]),_._v("，比如在"),t("strong",[_._v("秒以下的时间内进行修改，(比方说1s内修改了N次)")]),_._v("，"),t("code",[_._v("if-modified-since")]),_._v("能检查到的粒度是秒级的，这种修改无法判断(或者说UNIX记录MTIME只能精确到秒)；")]),_._v(" "),t("li",[_._v("某些"),t("strong",[_._v("服务器不能精确的得到文件的最后修改时间")]),_._v("。")])]),_._v(" "),t("h3",{attrs:{id:"_5-输入url、f5、-ctrl-f5-的区别"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-输入url、f5、-ctrl-f5-的区别"}},[_._v("#")]),_._v(" 5. 输入URL、"),t("code",[_._v("F5")]),_._v("、 "),t("code",[_._v("Ctrl + F5")]),_._v(" 的区别")]),_._v(" "),t("ol",[t("li",[_._v("实际上浏览器输入 "),t("code",[_._v("url")]),_._v(" 之后敲下回车就是先看本地 "),t("code",[_._v("cache-control")]),_._v("、"),t("code",[_._v("expires")]),_._v(" 的情况（"),t("strong",[_._v("先看强缓存")]),_._v("）；")]),_._v(" "),t("li",[_._v("刷新("),t("code",[_._v("F5")]),_._v(")就是忽略先看本地 "),t("code",[_._v("cache-control")]),_._v("、"),t("code",[_._v("expires")]),_._v(" 的情况，带上条件 "),t("code",[_._v("If-None-Match")]),_._v("、"),t("code",[_._v("If-Modified-Since")]),_._v("（"),t("strong",[_._v("忽略强缓存，直接尝试协商缓存")]),_._v("）；")]),_._v(" "),t("li",[_._v("强制刷新("),t("code",[_._v("Ctrl + F5")]),_._v(")就是不带条件的访问（"),t("strong",[_._v("忽略强缓存和协商缓存")]),_._v("）。"),t("code",[_._v("CTRL+F5")]),_._v("触发的HTTP请求的请求头中没有上面的那两个头，却有**"),t("code",[_._v("Pragma: no-cache")]),_._v("或"),t("code",[_._v("Cache-Control: no-cache")]),_._v("字段**，或者两者兼有。服务器看到"),t("code",[_._v("no-cache")]),_._v("这样的值就会把"),t("strong",[_._v("最新的文件")]),_._v("响应过去，也就跳过了缓存。")])]),_._v(" "),t("h3",{attrs:{id:"_6-缓存种类"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-缓存种类"}},[_._v("#")]),_._v(" 6. 缓存种类")]),_._v(" "),t("p",[_._v("缓存有"),t("strong",[_._v("内存缓存")]),_._v("和"),t("strong",[_._v("硬盘缓存")]),_._v("两种")]),_._v(" "),t("ul",[t("li",[_._v("内存缓存("),t("code",[_._v("from memory cache")]),_._v(")：内存缓存具有两个特点，分别是"),t("strong",[_._v("快速读取和时效性")]),_._v("；\n"),t("ul",[t("li",[_._v("快速读取：内存缓存会将编译解析后的文件，直接存入该进程的内存中，占据该进程一定的内存资源，以方便下次运行使用时的快速读取。")]),_._v(" "),t("li",[_._v("时效性：一旦该进程关闭，则该进程的内存则会清空。")])])]),_._v(" "),t("li",[_._v("硬盘缓存("),t("code",[_._v("from disk cache")]),_._v(")：硬盘缓存则是直接将缓存写入硬盘文件中，读取缓存需要对该缓存存放的硬盘文件进行"),t("code",[_._v("I/O")]),_._v("操作，然后重新解析该缓存内容，读取复杂，速度比内存缓存慢。")])]),_._v(" "),t("p",[t("code",[_._v("Base64")]),_._v(" 格式的图片，几乎永远可以被塞进 "),t("code",[_._v("memory cache")]),_._v("，这可以视作浏览器为节省渲染开销的“自保行为”；此外，体积不大的 JS、CSS 文件，也有较大地被写入内存的几率——相比之下，较大的 JS、CSS 文件就没有这个待遇了，内存资源是有限的，它们往往被直接甩进磁盘。")]),_._v(" "),t("h3",{attrs:{id:"_7-实际场景应用缓存策略"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-实际场景应用缓存策略"}},[_._v("#")]),_._v(" 7. 实际场景应用缓存策略")]),_._v(" "),t("h4",{attrs:{id:"_7-1-频繁变动的资源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-频繁变动的资源"}},[_._v("#")]),_._v(" 7.1. 频繁变动的资源")]),_._v(" "),t("p",[_._v("对于频繁变动的资源，首先"),t("strong",[_._v("需要使用"),t("code",[_._v("Cache-Control: no-cache")]),_._v(" 使浏览器每次都请求服务器")]),_._v("，然后"),t("strong",[_._v("配合 "),t("code",[_._v("ETag")]),_._v(" 或者 "),t("code",[_._v("Last-Modified")]),_._v(" 来验证资源是否有效")]),_._v("。这样的做法虽然不能节省请求数量，但是能显著减少响应数据大小。")]),_._v(" "),t("h4",{attrs:{id:"_7-2-不常变化的资源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-不常变化的资源"}},[_._v("#")]),_._v(" 7.2. 不常变化的资源")]),_._v(" "),t("p",[_._v("通常在处理这类资源时，给它们的 "),t("strong",[t("code",[_._v("Cache-Control")]),_._v(" 配置一个很大的 "),t("code",[_._v("max-age=31536000")]),_._v(" (一年)")]),_._v("，这样浏览器之后请求相同的 "),t("code",[_._v("URL")]),_._v(" 会命中强制缓存。而为了解决更新的问题，就需要"),t("strong",[_._v("在文件名(或者路径)中添加 "),t("code",[_._v("hash，")]),_._v(" 版本号等动态字符")]),_._v("，之后更改动态字符，从而达到更改引用 "),t("code",[_._v("URL")]),_._v(" 的目的，让之前的强制缓存失效 (其实并未立即失效，只是不再使用了而已)。")]),_._v(" "),t("p",[_._v("在线提供的类库 (如 "),t("code",[_._v("jquery-3.3.1.min.js")]),_._v(", "),t("code",[_._v("lodash.min.js")]),_._v(" 等) 均采用这个模式。")]),_._v(" "),t("p",[_._v("参考资料：")]),_._v(" "),t("ol",[t("li",[t("a",{attrs:{href:"https://www.cnblogs.com/everlose/p/12779864.html",target:"_blank",rel:"noopener noreferrer"}},[_._v("强缓存和协商缓存"),t("OutboundLink")],1)]),_._v(" "),t("li",[t("a",{attrs:{href:"https://blog.csdn.net/u012375924/article/details/82806617",target:"_blank",rel:"noopener noreferrer"}},[_._v("浅谈http中的Cache-Control"),t("OutboundLink")],1)]),_._v(" "),t("li",[t("a",{attrs:{href:"https://www.zhihu.com/question/22883627",target:"_blank",rel:"noopener noreferrer"}},[_._v("有了Etag，last-Modified还有必要存在吗"),t("OutboundLink")],1)]),_._v(" "),t("li",[t("a",{attrs:{href:"https://www.cnblogs.com/ziyunfei/p/5642796.html",target:"_blank",rel:"noopener noreferrer"}},[_._v("扼杀 304，Cache-Control: immutable"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);v.default=o.exports}}]);