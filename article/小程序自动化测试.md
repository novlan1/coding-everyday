[toc]

## 1. 概念
### 1.1. minium、minitest

`minium`是小程序的自动化框架，后面带个`nium`，类似的还有`appnium`、`selenium`。

`minitest`是基于`minium`的自动化测试服务，支持云测。

上面是我的臆测，这两概念是你中有我，我中有你的关系，比如下面的代码：

```python
class CreateGameTest(minium.MiniTest):
```



### 1.2. miniprogram-automator

`minium`和`miniprogram-automator`底层是同一套东西，前者语言是`python`，后者语言是`js/ts`，二者都不支持`headless`模式，无法在`linux`环境中运行。

另外，`miniprogram-automator`只能用开发者工具或真机，不能用云真机。

`minitest`包含云测服务，但是只能用`python`写用例。

#### 1.2.1. 启动

可以在测试脚本中启动：

```ts
// 工具 cli 位置，如果你没有更改过默认安装位置
const CLI_PATH = '/Applications/wechatwebdevtools.app/Contents/MacOS/cli'; 
// 项目文件地址
const PROJECT_PATH = '/Users/mike/Documents/web/dist/build/mp-weixin'; 

async function init() {
  miniProgram = await automator.launch({
    cliPath: CLI_PATH,
    projectPath: PROJECT_PATH,
  });
}
```


也可以在命令行中启动后，从脚本中连接：


```bash
# 进入微信开发者工具的安装目录
cd /Applications/wechatwebdevtools.app/Contents/MacOS
# 找到要执行自动化测试的目录
./cli --auto /Users/mike/Documents/web/dist/build/mp-weixin --auto-port 9420
```


```ts
async function init() {
  miniProgram = await automator.connect({
    wsEndpoint: 'ws://localhost:9420',
  });
}
```

## 2. minium

### 2.1. 路由跳转

测试路由跳转，不要用下面的方式，因为等待时间不可控，可能会花费更多的测试时间：

```python
time.sleep(3)
self.assertEqual(self.page.path, '/views/match-detail/match-detail')
```

可以用下面的方式：

```python
ret=self.app.wait_for_page('/views/match-detail/match-detail')
self.assertTrue(ret, 'wait success')
```

其他问题后面陆续补充～

## 3. 自动化测试与监控

自动化测试和监控都可以发现问题，二者有何区别？如何利用它们呢？

- 检测时机不同，自动化测试可以在预发布环境中进行，监控只能在发布后进行
- 成本方面，自动化测试编写、维护成本高于监控
- 覆盖范围，一般情况下监控覆盖的范围更广一些，测试用例由于成本高，覆盖范围很难很大

自动化测试可以用来检测主流程，以及上线前的检查。
