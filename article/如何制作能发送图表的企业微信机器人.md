### 一、前言

制作了一个企业微信机器人（tip-tool），目前实现了以下功能：远程发起MR、查看项目性能数据、机器人聊天。先看效果：

#### 1. 远程发起MR

<img src="http://doc.uwayfly.com/tip-tool-mr.png" width="600">

#### 2. 查看性能数据

##### 2.1. 查看所有项目的数据，以表格形式：

<img src="http://doc.uwayfly.com/tip-tool-pecker-table.png" width="600">

##### 2.2. 查看某一项的变化图，以折线图形式：

<img src="http://doc.uwayfly.com/tip-tool-pecker-line.png" width="600">

##### 2.3. 查看某一项目的所有数据项，以折线图集合形式：

<img src="http://doc.uwayfly.com/tip-tool-pecker-line-more.png" width="600">


性能数据还可以定时发送到小组群或个人，以及发现数据变化。

#### 3. 闲聊

<img src="http://doc.uwayfly.com/tip-tool-chat.png" width="600">


### 二、如何制作

#### 1. 机器人配置 
群聊右键，点击添加机器人：

<img src="http://doc.uwayfly.com/tip-tool-made.png" width="600">

填写回调地址，注意devnet机器一般不可以，如何解决可以参考[这里](https://km.woa.com/q/view/203106?from=iSearch)，如果遇到问题，也可以私聊我。

<img src="http://doc.uwayfly.com/tip-tool-webhook.png" width="600">

#### 2. 远程MR
远程MR比较简单，直接调用的蓝盾流水线的远程指令。

<img src="http://doc.uwayfly.com/tip-tool-landun.png" width="600">

#### 3. 性能数据推送
项目介入了[啄米鸟](http://lg.webdev.com/pecker/index)，所以性能数据直接取的该网站数据。机器人目前[markdown](https://open.work.weixin.qq.com/api/doc/90000/90136/91770#markdown%E7%B1%BB%E5%9E%8B)格式不支持表格，所以用canvas自己绘制，然后发送图片。总体流程如下：

```
获取数据 -> 画图 -> base64 -> 保存文件 -> 获取md5
```

### 三、相关资料

1. [群机器人回调说明](https://work.weixin.qq.com/api/doc/90000/90136/91881)
2. [canvas图表详解系列（2）：折线图](https://www.cnblogs.com/chengduxiaoc/p/7678967.html)
3. [各位企业微信机器人的作者，消息回调服务都部署在哪里呢？](https://km.woa.com/q/view/203106?from=iSearch) 
4. [公司网络安全域及访问控制策略](https://km.woa.com/group/31829/articles/show/367253?kmref=search&from_page=1&no=1)
5. [里约](http://rio.oa.com/open/)
6. [研发环境资源&指引总览(wiki)](https://iwiki.woa.com/pages/viewpage.action?pageId=15011356)
