自动化测试的的最佳落地方案探索
小组内的自动化测试在之前基础上进行了扩展和完善，现在已经形成了完整的闭环。

自动化测试能快速发现页面问题，尤其是在持续部署的研发流程中。


## 一、自动化测试架构

<img src="http://doc.uwayfly.com/auto-test-framework.png" width="500">

1、搭建[自动化测试平台网站](http://mobile.oa.com/pmd-auto-test/#/index)，可配置待检测的查看元素和点击元素。

这种配置方式比在七彩石配置的优势是可视化，利于扩展。（如果其他部门有合作的想法，欢迎沟通。）

<img src="http://doc.uwayfly.com/auto-test-config.png" width="500">

2、编写脚本，根据配置的元素自动生成测试用例。主要是利用模板生成的方式。

3、流水线定时执行自动测试任务，并接入了[eptest平台](http://eptest.oa.com)，可以在eptest平台上进行测试用例和任务的管理。

<img src="http://doc.uwayfly.com/eptest.png" width="500">

4、对自动化测试的截图进行保存，并上传到腾讯云。

5、自动化测试结果生成测试报告，如下图，在线示例报告在[这里](http://logicdata.eptest.oa.com/cos/view?path=logdata/2718047/e2e/view.html)。

<img src="http://doc.uwayfly.com/auto-test-report.png" width="500">

6、如果遇到失败的测试用例，会通过机器人进行及时的通知，把失败的用例以及截图一并发送。

<img src="http://doc.uwayfly.com/auto-test-alarm.png" width="500">

开发人员接收到报警信息，可立即查看页面和代码定位问题，也可修改[配置平台](http://mobile.oa.com/pmd-auto-test)的用例信息。

7、也可向机器人主动发送消息，查看最近一次自动化测试的结果。

<img src="http://doc.uwayfly.com/auto-test-query.png" width="500">

## 二、[自动测试配置平台](http://mobile.oa.com/pmd-auto-test)
1、[配置项](http://mobile.oa.com/pmd-auto-test/#/index)

配置平台的可配置项有三级：`项目` -> `页面` -> `路由`。

项目目前有赛事平台和商户平台，页面则对应git的一个个工程，如`hp-match`，路由对应vue中的路由。

2、[管理员](http://mobile.oa.com/pmd-auto-test/#/app/app)

出于安全性考虑，设置了分级管理员，超级管理员有管理项目的权限，普通管理员可以管理页面和路由。

3、[操作记录](http://mobile.oa.com/pmd-auto-test/#/record/record)

利用操作记录，进一步增强了配置平台的安全性，并且可回溯。

<img src="http://doc.uwayfly.com/auto-test-config-record.png" width="500">

## 三、总结

自动化测试落地的过程中，组内搭建了[自动化测试配置平台](http://mobile.oa.com/pmd-auto-test/#/index)、[企业微信机器人](https://km.woa.com/articles/show/506520)，利用公司的[蓝盾平台](http://devops.oa.com/console/)、[eptest平台](http://eptest.oa.com)、[腾讯云](https://cloud.tencent.com/)，并编写了一系列脚本将上述工具结合，使自动化测试形成完整闭环。

目前测试的重要性日益提高，用户对系统稳定性的要求也越来越高，稳健的自动化测试工具对维持系统稳定有一定作用。


## 四、相关资料

1. 自动化测试配置平台：http://mobile.oa.com/pmd-auto-test/#/index
2. Eptest平台：http://eptest.oa.com
3. 企业微信机器人文档：https://work.weixin.qq.com/api/doc/90000/90136/91881
4. Puppeteer文档：https://github.com/puppeteer/puppeteer
5. Jest文档：https://jestjs.io/ 
6. 如何制作能发送图表的企业微信机器人: https://km.woa.com/articles/show/506520
7. 京喜前端自动化测试之路: https://juejin.cn/post/6844904150631710727
8. 试试前端自动化测试：https://juejin.cn/post/6844904194600599560
9. 前端自动化测试的核心概念及思考: https://juejin.cn/post/6891851469897760776
10. webdriver和puppeteer在实现原理上有什么区别: https://www.zhihu.com/question/278723746

